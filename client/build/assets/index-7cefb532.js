import{r as c,H as Ne,j as e,ae as k,m as w,aw as A,aO as M,aP as q,aQ as B,bq as L,br as W,as as X,bA as H,av as E,bB as V,bt as Q,aM as T,B as ce,bG as se,bi as _e,bk as Ce,bl as te,bm as ke,bn as Ie,bo as S,a3 as Se,a4 as $e,a5 as Pe,a6 as Ae,a7 as Re,a8 as ae,aL as F,R as Te,bH as ze,af as G,bI as Fe,bJ as ne,by as Ee,c8 as we,aI as De,a2 as J,aN as Oe,c9 as Me,b5 as qe,b4 as Be,bb as ie,o as de,A as oe,ca as ue,cb as Le,cc as We,cd as He,ce as Ve,cf as xe,cg as Z,ch as le,ci as Qe,cj as Ke,ck as Ue,bS as re,C as Ye,a_ as Ge,bc as Xe,bd as Je,be as Ze,bf as es,cl as ss}from"./index-460140f2.js";import{C as K,c as me,g as ts,a as as,P as ns,d as is,b as ls,M as rs,A as cs,N as ee,f as U,T as ds}from"./useInventoryProductCalculations-ebe095ab.js";import{P as os,D as he,u as us,f as xs}from"./timeUtils-853545c6.js";import"./index-ff61ddef.js";const pe=c.createContext(void 0),ms=({children:s})=>{const[n,l]=c.useState("main"),[r,x]=c.useState(),{data:i,isLoading:f}=Ne(),m={inventories:i,isInventoriesLoading:f,selectedInventory:r,setSelectedInventory:x,activeTab:n,setActiveTab:l};return e.jsx(pe.Provider,{value:m,children:s})};function D(){const s=c.useContext(pe);if(!s)throw new Error("useAddProductPos hook must be used within AddProductPosProvider");return s}const Y=({title:s,subtitle:n,icon:l,onClick:r})=>e.jsxs(k,{className:"flex h-fit flex-1 flex-col gap-8 rounded-xl bg-gray-300 p-16 pb-12 text-slate-800 hover:text-white",onClick:r||(()=>{}),children:[l&&l,e.jsxs("span",{children:[e.jsx("p",{className:"text-lg font-bold",children:s}),n&&e.jsx("p",{className:"text-sm opacity-70",children:n})]})]}),hs=()=>{const{auth:s}=w(),{inventories:n,isInventoriesLoading:l,selectedInventory:r,setSelectedInventory:x}=D(),f=n.filter(u=>{var p;return(s==null?void 0:s.role)!=="admin"&&(s==null?void 0:s.role)!=="super_admin"?u.warehouse.code.includes(((p=s==null?void 0:s.role)==null?void 0:p.split("_")[1])??""):n}).sort((u,p)=>new Date(p.updated_at??p.created_at).getTime()-new Date(u.updated_at??u.created_at).getTime()),[m,o]=c.useState(!1);return e.jsxs("div",{className:"flex flex-col justify-center gap-1",children:[e.jsx(A,{htmlFor:"inventory",className:"text-sm font-bold text-gray-600",children:"Inventory"}),e.jsxs(M,{open:m,onOpenChange:o,children:[e.jsx(q,{id:"inventory",name:"inventory",className:"relative w-full",asChild:!0,children:e.jsxs(k,{role:"combobox",className:"justify-between truncate bg-white text-sm font-bold text-slate-600",variant:"outline",children:[r?e.jsxs("div",{className:"flex items-center font-bold text-slate-600",children:[r.code,e.jsx("span",{className:"ml-1 text-xs opacity-80",children:" • "+r.type+" • "+r.date_received})]}):e.jsx("span",{children:"Select an inventory..."}),e.jsx(K,{size:14,strokeWidth:2,className:"h-4 w-4 opacity-70"})]})}),e.jsx(B,{className:"w-[calc(100vw-170px)] max-w-[974px] p-0 text-sm font-medium text-slate-700",children:e.jsxs(L,{defaultValue:(r==null?void 0:r.code)||"",children:[e.jsx(W,{placeholder:"Inventory code..."}),l&&e.jsx("div",{className:"flex h-16 w-full items-center justify-center",children:e.jsx(X,{size:22,strokeWidth:2.5,className:"animate-spin text-slate-700/50"})}),e.jsx(H,{children:"No results found"}),e.jsx(E,{className:"max-h-[200px] overflow-y-scroll",children:e.jsx(V,{children:f&&f.map(u=>e.jsxs(Q,{className:"cursor-pointer justify-between rounded-sm",value:u.code,onSelect:()=>{x(u),o(!1)},children:[e.jsx("span",{children:u.code}),e.jsx("span",{className:"text-xs font-semibold text-slate-600",children:u.type+" • "+u.date_received})]},u.id))})})]})})]})]})},ps=({setInventoryProductsQueue:s,inventoryId:n,products:l,productsLoading:r,suppliers:x,suppliersLoading:i,currentId:f,handleNavigation:m,selectedProduct:o})=>{var C,O,y,N;const{auth:u}=w(),p=!!((C=u.rolePermissions)!=null&&C.find(a=>a.permission_id===7)),{value:d,handleChange:h}=me(),[P,_]=c.useState(!1),[t,v]=c.useState(!1),[j,$]=c.useState(null);c.useEffect(()=>{h("inventory_id",n),h("unit","pcs"),p&&h("status",1),o&&(h("product_id",o.data.product_id),h("status",o.data.status),h("supplier_id",o.data.supplier_id),h("capital_price",o.data.capital_price),h("unit",o.data.unit),h("stocks_count",o.data.stocks_count),h("damage_count",o.data.damage_count),h("total_count",o.data.total_count)),!o&&!p&&h("capital_price",0)},[]);const[b,I]=c.useState();return c.useEffect(()=>{const a=ts(d.stocks_count||0,d.damage_count||0);I(a),h("total_count",a)},[d.damage_count,d.stocks_count,b]),e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:a=>{a.preventDefault(),d.product_id===void 0?$("Please select a product first."):d.supplier_id===void 0?$("Please select a supplier first."):(s(o?g=>[...g.filter(ye=>ye.id!==o.id),{id:o.id,data:d}]:g=>[...g,{id:f+1,data:d}]),m())},children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsxs("div",{className:"mt-3 grid w-full grid-flow-row grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-8 flex flex-col justify-center gap-1",children:[e.jsx(A,{htmlFor:"product_id",className:"text-sm font-bold text-gray-600",children:"Product"}),e.jsxs(M,{open:P,onOpenChange:_,children:[e.jsx(q,{id:"product_id",className:"relative w-full",asChild:!0,autoFocus:!0,children:e.jsxs(k,{role:"combobox",className:"w-full justify-between text-sm font-bold text-slate-700",variant:"outline",children:[d.product_id?e.jsx(e.Fragment,{children:(()=>{const a=l.find(g=>g.id===d.product_id);return e.jsxs("div",{className:"flex w-full flex-row items-baseline gap-4",children:[e.jsx("span",{children:a==null?void 0:a.name}),e.jsxs("div",{className:"flex gap-4 truncate text-xs font-semibold",children:[(a==null?void 0:a.brand)&&e.jsx("span",{children:`Brand: ${a==null?void 0:a.brand}`}),(a==null?void 0:a.size)&&e.jsx("span",{children:`Size: ${a==null?void 0:a.size}`}),(a==null?void 0:a.color)&&e.jsx("span",{children:`Color: ${a==null?void 0:a.color}`})]})]})})()}):e.jsx("span",{children:"Select a product..."}),e.jsx(K,{size:14,strokeWidth:2,className:"h-4 w-4 opacity-70"})]})}),e.jsx(B,{className:`${p?"max-w-[966px]":"max-w-[640px]"} w-[calc(100vw-170px)] p-0 text-sm font-medium text-slate-700`,children:e.jsxs(L,{children:[e.jsx(W,{placeholder:"Product name or serial number..."}),r&&e.jsx("div",{className:"flex h-16 w-full items-center justify-center",children:e.jsx(X,{size:22,strokeWidth:2.5,className:"animate-spin text-slate-700/50"})}),e.jsx(H,{children:"No match found"}),e.jsx(E,{className:"max-h-[200px] overflow-y-scroll",children:e.jsx(V,{children:l.map((a,g)=>e.jsx(Q,{className:"cursor-pointer justify-between rounded-sm border-b",value:a.id+"_"+a.name+"_"+a.serial_no,onSelect:()=>{h("product_id",a.id),_(!1)},children:`${a.name} • ${a.brand} • ${a.size} • ${a.color}`},g))})})]})})]})]}),e.jsxs("div",{className:"col-span-4 flex flex-col justify-center gap-1",children:[e.jsx(A,{htmlFor:"supplier_id",className:"text-sm font-bold text-gray-600",children:"Supplier"}),e.jsxs(M,{open:t,onOpenChange:v,children:[e.jsx(q,{id:"supplier_id",className:"relative w-full",asChild:!0,children:e.jsxs(k,{role:"combobox",className:"w-full justify-between text-sm font-bold text-slate-700",variant:"outline",children:[d.supplier_id?e.jsx(e.Fragment,{children:(()=>{const a=x.find(g=>g.id===d.supplier_id);return e.jsxs("div",{className:"flex w-full items-baseline gap-4 capitalize",children:[e.jsx("span",{className:"max-w-full truncate",children:a==null?void 0:a.name}),e.jsx("span",{className:"font-baseline text-xs text-slate-700/50",children:a==null?void 0:a.address})]})})()}):e.jsx("span",{children:"Select a supplier..."}),e.jsx(K,{size:14,strokeWidth:2,className:"h-4 w-4 opacity-70"})]})}),e.jsx(B,{className:"min-w-[477px] p-0 text-sm font-medium text-slate-700",children:e.jsxs(L,{children:[e.jsx(W,{placeholder:"Supplier name or address..."}),i&&e.jsx("div",{className:"flex h-16 w-full items-center justify-center",children:e.jsx(X,{size:22,strokeWidth:2.5,className:"animate-spin text-slate-700/50"})}),e.jsx(H,{children:"No match found"}),e.jsx(E,{className:"max-h-[200px] overflow-y-scroll",children:e.jsx(V,{children:x.map((a,g)=>e.jsxs(Q,{className:"cursor-pointer justify-between rounded-sm",onSelect:()=>{h("supplier_id",a.id),v(!1)},children:[e.jsx("span",{children:a.name}),e.jsx("span",{className:"text-xs font-semibold text-slate-700/50",children:a.address})]},g))})})]})})]})]})]}),e.jsx("hr",{className:"my-2 h-px w-full border-0 bg-gray-200"}),e.jsxs("div",{className:"grid w-full grid-flow-row grid-cols-12 gap-3",children:[e.jsxs("div",{className:`relative flex flex-col justify-center gap-1 ${p?"col-span-6":"hidden"}`,children:[e.jsx(A,{htmlFor:"capital_price",className:"text-sm font-bold text-gray-600",children:"Capital price"}),e.jsx(T,{id:"capital_price",name:"capital_price",type:"number",min:0,step:.01,required:!0,className:"pl-8",placeholder:"0.00",disabled:!p,value:d.capital_price||"",onBlur:a=>{d.capital_price!==void 0&&(a.target.value=Number(a.target.value).toFixed(2))},onChange:a=>{h("capital_price",Number(Number(a.target.value).toFixed(2)))}}),e.jsx("span",{className:"absolute bottom-0 left-0 pb-[0.65rem] pl-3 text-sm font-semibold text-gray-500",children:"₱"})]}),e.jsxs("div",{className:`flex flex-col justify-center gap-1 ${p?"col-span-6":"col-span-3"}`,children:[e.jsx(A,{htmlFor:"unit",className:"text-sm font-bold text-gray-600",children:"Unit"}),e.jsx(T,{id:"unit",name:"unit",type:"text",maxLength:40,required:!0,value:d.unit||"",onChange:a=>h("unit",a.target.value)})]}),e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(A,{htmlFor:"stocks_count",className:"text-sm font-bold text-gray-600",children:"Stocks count"}),e.jsx(T,{id:"stocks_count",name:"stocks_count",type:"number",min:0,max:9999999,step:1,value:(O=d.stocks_count)==null?void 0:O.toFixed(0),required:!0,onChange:a=>{h("stocks_count",Number(Number(a.target.value).toFixed(0)))}})]}),e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(A,{htmlFor:"damage_count",className:"text-sm font-bold text-gray-600",children:"Damage count"}),e.jsx(T,{id:"damage_count",name:"damage_count",type:"number",min:0,max:d.stocks_count??0,step:1,required:!0,value:(y=d.damage_count)==null?void 0:y.toFixed(0),onChange:a=>h("damage_count",Number(Number(a.target.value).toFixed(0)))})]}),e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(A,{htmlFor:"total_count",className:"text-sm font-bold text-gray-600",children:"Total count"}),e.jsx(T,{id:"total_count",name:"total_count",type:"number",min:0,max:9999999,step:1,readOnly:!0,value:b??"0",className:`${b&&b<0&&"text-red-600"}`})]}),((N=u.role)==null?void 0:N.includes("admin"))&&e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(A,{htmlFor:"total_count",className:"text-sm font-bold text-gray-600",children:"Approve stocks"}),e.jsx(T,{id:"total_count",name:"total_count",type:"number",min:0,max:d.stocks_count??0,step:1,value:d.approved_stocks!==void 0?String(d.approved_stocks):"",onChange:a=>h("approved_stocks",a.target.value),onBlur:a=>{h("approved_stocks",Number(a.target.value))}})]})]}),e.jsx("div",{className:"flex w-full justify-between whitespace-nowrap pt-6",children:e.jsx("div",{className:"ml-auto flex flex-row gap-4",children:e.jsx(ce,{type:"submit",fill:"green",disabled:d.product_id===void 0||d.supplier_id===void 0,className:"max-w-fit flex-1 py-2 text-sm font-bold text-white disabled:cursor-not-allowed disabled:opacity-50",children:o?"Save changes":"Add item to queue"})})}),j&&e.jsx("div",{className:"flex w-full flex-row justify-center gap-4",children:e.jsx("p",{className:"text-sm font-bold text-red-600",children:j})})]})})})},fs=["","Name","Brand","Size","Color","Supplier","Capital price","Unit","Stocks","Damaged","Total","Approved"],js=({data:s,products:n,suppliers:l,handleEditItem:r,handleRemoveItem:x,handleSubmit:i})=>{var _;const{auth:f}=w(),m=!!((_=f.rolePermissions)!=null&&_.find(t=>t.permission_id===7)),{setSelectedInventory:o}=D(),[u,p]=c.useState(!1),[d,h]=c.useState(null),P=async()=>{p(!0);const t=await i({action:"batch-add",data:s.map(j=>j==null?void 0:j.data)}).then(j=>{Array.isArray(j)&&j.length>0&&(F.success("Items added to inventory",{autoClose:5e3,closeButton:!0}),o(void 0))}).catch(()=>{F.error("Error adding items to inventory",{autoClose:5e3,closeButton:!0})});(Array.isArray(t)?t.filter(j=>j!==201):[]).length>0?h("Error adding items to inventory"):p(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsxs(E,{type:"always",className:"flex-1 rounded-md border border-gray-200 bg-white",style:{"--border":"216 12% 84%"},children:[s.length<=0&&e.jsx("div",{className:"absolute z-10 flex h-full w-full items-center justify-center",children:e.jsx("p",{className:"text-lg font-medium text-gray-500/50",children:"No items in queue"})}),e.jsx(se,{orientation:"horizontal",className:"z-50 h-3"}),e.jsx(se,{orientation:"vertical",className:"z-50 h-3",style:{"--border":"216 12% 84%"},asChild:!0}),e.jsxs(_e,{children:[e.jsx(Ce,{children:e.jsx(te,{id:"tHeaderRow",className:"hover:bg-white",children:fs.map(t=>{if(t!=="Capital price"||m)return e.jsx(ke,{className:"whitespace-nowrap px-5 py-3 text-xs font-bold uppercase",children:t},t+"_head")})},"tHeaderRow")}),e.jsx(Ie,{className:"[&>*:nth-child(even)]:bg-white [&>*:nth-child(odd)]:bg-gray-50",children:s.length>0&&s.map(t=>{var v,j,$,b,I;return e.jsxs(te,{className:"text-sm font-medium text-gray-700",children:[e.jsx(S,{className:"p-3 pr-0",children:e.jsx("div",{className:"flex flex-row justify-center text-xs font-normal uppercase",children:e.jsxs(Se,{children:[e.jsx($e,{className:"overflow-clip rounded-full bg-gray-200/70 p-1.5 hover:bg-gray-300",children:e.jsx(as,{size:16,strokeWidth:2.25})}),e.jsxs(Pe,{className:"relative z-50 w-44 bg-white font-medium",children:[e.jsx(Ae,{children:"Actions"}),e.jsx(Re,{className:"bg-gray-200"}),e.jsxs(ae,{onClick:()=>{t!=null&&t.id&&r(t)},className:"flex flex-row items-center gap-3 rounded-md p-2 hover:bg-gray-200",children:[e.jsx("span",{className:"flex w-6 items-center justify-center",children:e.jsx(ns,{size:16,strokeWidth:2})}),e.jsx("span",{children:"Edit"})]},(t==null?void 0:t.id)+"edit"),e.jsxs(ae,{onClick:()=>{t!=null&&t.id&&x(t.id)},className:"flex flex-row items-center gap-3 rounded-md p-2 focus:bg-red-50 focus:text-red-700",children:[e.jsx("span",{className:"flex w-6 items-center justify-center",children:e.jsx(is,{size:16,strokeWidth:2})}),e.jsx("span",{children:"Remove"})]},(t==null?void 0:t.id)+"remove")]})]})})},(t==null?void 0:t.id)+"action"),e.jsx(S,{className:"max-w-[200px] truncate px-5 py-3",children:t!=null&&t.data.product_id?(v=n.find(C=>C.id===t.data.product_id))==null?void 0:v.name:t==null?void 0:t.data.product_id},(t==null?void 0:t.id)+"product_id"),e.jsx(S,{className:"max-w-[200px] truncate px-5 py-3",children:t!=null&&t.data.product_id?(j=n.find(C=>C.id===t.data.product_id))==null?void 0:j.brand:"No brand"},(t==null?void 0:t.id)+"product_brand"),e.jsx(S,{className:"max-w-[200px] truncate px-5 py-3",children:t!=null&&t.data.product_id?($=n.find(C=>C.id===t.data.product_id))==null?void 0:$.size:"No data"},(t==null?void 0:t.id)+"product_size"),e.jsx(S,{className:"max-w-[200px] truncate px-5 py-3",children:t!=null&&t.data.product_id?(b=n.find(C=>C.id===t.data.product_id))==null?void 0:b.color:"No data"},(t==null?void 0:t.id)+"product_color"),e.jsx(S,{className:"max-w-[200px] truncate px-5 py-3",children:t!=null&&t.data.supplier_id?(I=l.find(C=>C.id===t.data.supplier_id))==null?void 0:I.name:t==null?void 0:t.data.supplier_id},(t==null?void 0:t.id)+"supplier_id"),m&&e.jsx(S,{className:"px-5 py-3",children:Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format((t==null?void 0:t.data.capital_price)||0)},(t==null?void 0:t.id)+"capital_price"),e.jsx(S,{className:"px-5 py-3",children:t==null?void 0:t.data.unit},(t==null?void 0:t.id)+"unit"),e.jsx(S,{className:"px-5 py-3",children:t==null?void 0:t.data.stocks_count},(t==null?void 0:t.id)+"stocks_count"),e.jsx(S,{className:"px-5 py-3",children:t==null?void 0:t.data.damage_count},(t==null?void 0:t.id)+"damage_count"),e.jsx(S,{className:"px-5 py-3",children:t==null?void 0:t.data.total_count},(t==null?void 0:t.id)+"total_count"),e.jsx(S,{className:"px-5 py-3",children:t==null?void 0:t.data.approved_stocks},(t==null?void 0:t.id)+"approved_stocks")]},(t==null?void 0:t.id)+"row")})})]})]}),e.jsxs("div",{className:"flex w-full justify-between whitespace-nowrap pt-6",children:[d&&e.jsx("div",{className:"flex w-full flex-row items-center justify-start gap-4",children:e.jsx("p",{className:"text-sm font-bold text-red-600",children:d})}),e.jsx("div",{className:"ml-auto flex flex-row gap-4",children:e.jsx(ce,{type:"submit",fill:"green",disabled:s.length<=0||u,className:"max-w-fit flex-1 py-2 text-sm font-bold text-white disabled:cursor-not-allowed disabled:opacity-50",onClick:t=>{t.preventDefault(),P()},children:s.length<=1?"Add item to inventory":`Add ${s.length} items to inventory`})})]})]})})},bs={hidden:{opacity:0,x:"-100%"},animate:{opacity:1,x:"0%",transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,x:"-100%",transition:{duration:.3,ease:"easeInOut"}}},vs={hidden:{opacity:0,x:"100%"},animate:{opacity:1,x:"0%",transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,x:"100%",transition:{duration:.3,ease:"easeInOut"}}},gs=({inventoryId:s})=>{const{auth:n}=w(),{data:l,isLoading:r}=Te(),{suppliers:x,isFetching:i}=ze(),{handleSubmit:f}=me(),[m,o]=c.useState([]),[u,p]=c.useState({});c.useEffect(()=>{o([])},[s]);const[d,h]=c.useState("main"),P=()=>{p({}),h(d==="main"?"form":"main")},_=v=>{p(v),h("form")},t=v=>{o(j=>j.filter($=>$.id!==v))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:d==="main"?"ml-auto":"",children:e.jsx(k,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{P()},children:e.jsxs(e.Fragment,{children:[d==="main"?e.jsx(os,{size:20,strokeWidth:2.5}):e.jsx(G,{size:20,strokeWidth:2.5}),d==="main"?"Add an item":"Back"]})})}),e.jsx("div",{className:`relative max-h-[65vh] min-w-[650px] overflow-x-clip transition-all duration-300 
					${d==="form"?n.role==="admin"||n.role==="super_admin"?"h-[340px] min-h-[340px]":"h-[260px] min-h-[260px]":"h-[65vh] min-h-[415px]"}`,children:e.jsx(Fe,{initial:!1,children:d==="main"?e.jsx(ne.div,{variants:bs,initial:"hidden",animate:"animate",exit:"exit",className:"absolute h-full w-full overflow-x-auto antialiased",children:e.jsx(js,{data:m,products:l,suppliers:x,handleEditItem:_,handleRemoveItem:t,handleSubmit:f})},"main"):e.jsx(ne.div,{variants:vs,initial:"hidden",animate:"animate",exit:"exit",className:"absolute max-h-[642px] w-full p-1",children:e.jsx(ps,{setInventoryProductsQueue:o,inventoryId:s,products:l,productsLoading:r,suppliers:x,suppliersLoading:i,currentId:m.reduce((v,j)=>j.id>v?j.id:v,0),handleNavigation:P,selectedProduct:Object.keys(u).length?u:void 0})},"form")})})]})})},ys=()=>{const{selectedInventory:s}=D();return e.jsxs("div",{className:"w-full space-y-4 rounded-lg border bg-white p-6",children:[e.jsx(hs,{}),s&&e.jsx(gs,{inventoryId:s.id})]})},Ns=()=>{const{setActiveTab:s}=D();return e.jsxs("div",{className:"mx-auto flex w-full flex-row items-center gap-4",children:[e.jsx(Y,{title:"Register Product Item",subtitle:"Create new unique product...",icon:e.jsx(Ee,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>s("add_product")}),e.jsx(Y,{title:"Inventory Product",subtitle:"Add existing products to inventory...",icon:e.jsx(we,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>s("select_inventory")})]})},_s=({openModal:s})=>{const{data:n,isLoading:l}=De(),r=()=>{s({},"add")};return e.jsx("div",{className:"max-h-full w-full flex-1 rounded-lg border border-black/10 bg-white",children:e.jsx(he,{columns:ls,data:n.sort((x,i)=>i.id-x.id),filterWhat:"name",dataType:"Product",openModal:r,isLoading:l})})},Cs=()=>{const{activeTab:s,setActiveTab:n}=D(),l=J(),{isOpen:r,openModal:x,closeModal:i}=us(),[f,m]=c.useState(""),o=(u,p)=>{x(),m(p)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full flex-row items-start justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Add Product"}),e.jsxs(k,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{s==="main"?l("/pos/add-order"):n("main")},children:[e.jsx(G,{size:20,strokeWidth:2.5}),s==="main"?"Go back":"Main menu"]})]}),(s==="main"||s===void 0)&&e.jsx(Ns,{}),s==="select_inventory"&&e.jsx(ys,{})," ",s==="add_product"&&e.jsx(_s,{openModal:o}),e.jsx("div",{children:e.jsx(rs,{isOpen:r,onClose:i,title:f==="add"?"Add Product":"Edit Product",children:e.jsx(e.Fragment,{children:f==="add"&&e.jsx(cs,{onClose:i})})})})]})},Gs=()=>e.jsxs("div",{className:"flex h-screen w-screen flex-row",children:[e.jsx(ee,{}),e.jsx(ms,{children:e.jsxs(Oe,{children:[e.jsx("div",{className:"max-h-full w-full overflow-y-auto p-6 pt-12 text-slate-700",children:e.jsx("div",{className:"mx-auto max-w-[1024px] space-y-6",children:e.jsx(Cs,{})})}),e.jsx(Me,{})]})})]}),Xs=()=>{const{setSearchFilterItems:s}=qe(),{currentInvoicePos:n,setCurrentInvoicePos:l}=Be(),r=J();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-screen w-screen flex-row",children:[e.jsx(ee,{}),e.jsx("div",{className:"max-h-full w-full overflow-y-auto p-6 pt-12 text-slate-700",children:e.jsxs("div",{className:"mx-auto max-w-[1024px] space-y-6",children:[e.jsxs("div",{className:"flex w-full flex-row items-start justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Select Warehouse to start selling"}),e.jsxs(k,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{r(-3)},children:[e.jsx(G,{size:20,strokeWidth:2.5}),"Go Back"]})]}),e.jsxs("div",{className:"mx-auto flex w-full flex-row items-center gap-4",children:[e.jsx(Y,{title:"Select CDO Warehouse",subtitle:"Cdo available products",icon:e.jsx(ie,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>{s({warehouse_id:1}),l({...n,warehouse_id:1}),r("/pos/add-order")}}),e.jsx(Y,{title:"Select Iligan Warehouse",subtitle:"Iligan available products",icon:e.jsx(ie,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>{s({warehouse_id:2}),l({...n,warehouse_id:2}),r("/pos/add-order")}})]})]})})]})})},ks=async s=>await de.post(oe.RETURN_TRANSACTIONS,s,{headers:ue()}).then(n=>n.data.data).catch(n=>{throw console.error("Error submitting return invoice:",n),n}),Is=async s=>await de.post(`${oe.RETURN_TRANSACTIONS}/searches-filters-sorts`,{search:{code:s}},{headers:ue()}).then(n=>n.data.data).catch(n=>{throw console.error("Error fetching return transaction by code:",n),n}),fe=c.createContext(void 0),Ss=({children:s})=>{const[n,l]=c.useState({}),[r,x]=c.useState(void 0),[i,f]=c.useState(),[m,o]=c.useState([]),[u,p]=c.useState([]),[d,h]=c.useState(),[P,_]=c.useState(!1),{auth:t}=w(),v=async y=>(l({}),x(void 0),o([]),p([]),await Is(`RET-${y}`).then(N=>{if(N.find(g=>g.code===`RET-${y}`))throw"Invoice already has return transaction history.";return Le(y).then(g=>(l({code:`RET-${g.code}`,invoice_id:g.id,issued_by:(t==null?void 0:t.user.id)||0,refundable_amount:0,refund_status:"done",is_cash_refund:0}),x(g),o(g.invoice_items),"Invoice found.")).catch(()=>{throw"Code not found. Please try again."})})),j=(y,N)=>{l(a=>({...a,return_items:a.return_items.map(g=>g.invoice_item_id===y?{...g,quantity:N}:g)}))};c.useEffect(()=>{if(n.return_items){const y=n.return_items.reduce((N,a)=>N+a.quantity*a.price,0);l(N=>({...N,refundable_amount:y}))}},[n.return_items]);const[$,b]=c.useState(!1),I=async()=>(b(!0),await ks(n).then(y=>(h(y.voucher??void 0),_(!!y.voucher),l({}),x(void 0),o([]),p([]),b(!1),"Items successfully returned.")).catch(()=>{throw b(!1),"Failed to return items. Please try again."})),C=y=>{p(N=>N.filter(a=>a.id!==y)),l(N=>({...N,return_items:N.return_items.filter(a=>a.invoice_item_id!==y)}))};c.useEffect(()=>{console.log("items",n.return_items),console.log("selected items",u)},[n.return_items,u]);const O={returnInvoice:n,setReturnInvoice:l,invoiceCode:i,setInvoiceCode:f,returnableItems:m,setReturnableItems:o,searchInvoice:v,selectedInvoice:r,setSelectedInvoice:x,selectedItems:u,setSelectedItems:p,updateQuantity:j,handleSubmit:I,isSubmitting:$,setIsSubmitting:b,removeReturnItem:C,voucher:d,setVoucher:h,isVoucherDialogOpen:P,setIsVoucherDialogOpen:_};return e.jsx(fe.Provider,{value:O,children:s})};function R(){const s=c.useContext(fe);if(!s)throw new Error("useReturnInvoice must be used within ReturnInvoiceProvider");return s}const $s=()=>{const{selectedInvoice:s}=R();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Customer: "}),e.jsxs("span",{className:"font-medium capitalize",children:[s==null?void 0:s.customer.firstname," ",s==null?void 0:s.customer.lastname]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Created at: "}),e.jsx("span",{className:"font-medium capitalize",children:xs((s==null?void 0:s.created_at)??"")})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Paid Amount: "}),e.jsx("span",{className:"font-medium capitalize",children:U((s==null?void 0:s.paid_amount)??0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Total Amount: "}),e.jsx("span",{className:"font-medium capitalize",children:U((s==null?void 0:s.total_amount_due)??0)})]})]}),e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Total Items: "}),e.jsx("span",{className:"font-medium capitalize",children:s==null?void 0:s.invoice_items.length})]})})]})})},Ps=({isOpen:s})=>{const{returnableItems:n,returnInvoice:l,setReturnInvoice:r,setSelectedItems:x}=R();return console.log("Return Invoice Items:",n),e.jsx(e.Fragment,{children:n.map((i,f)=>e.jsx(Q,{value:i.product.id+"_"+i.product.name+"_"+i.product.serial_no,className:`${l.return_items&&l.return_items.find(m=>m.invoice_item_id===i.id)?"hidden":""}`,onSelect:()=>{x(o=>[...o,i]);const m=[...l.return_items||[],{invoice_item_id:i.id,quantity:1,unit:i.unit,price:i.product_price,reason:"return"}];r(o=>({...o,return_items:m})),s(!1)},children:e.jsxs("div",{className:"flex w-full flex-row justify-between",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[i.product.brand&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-slate-500",children:["(",i.product.brand,")"]}),"•"]}),e.jsx("span",{className:"text-base font-bold",children:i.product.name}),"•",e.jsx("span",{className:"text-sm capitalize text-slate-500",children:i.product.size}),"•",e.jsx("span",{className:"text-sm capitalize text-slate-700",children:i.product.color})]}),e.jsxs("div",{className:"flex flex-row gap-3",children:[i.quantity>1?e.jsxs("span",{children:[i.quantity," pcs"]}):e.jsxs("span",{children:[i.quantity," pc"]}),e.jsx("span",{className:"font-bold",children:U(i.product_price)})]})]})},f))})},As=({})=>{const[s,n]=c.useState(!1);return e.jsxs(M,{open:s,onOpenChange:n,children:[e.jsx(q,{asChild:!0,children:e.jsxs(k,{variant:"outline",role:"combobox","aria-expanded":s,className:"w-full justify-between",children:["Select Items...",e.jsx(K,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(B,{className:"w-full min-w-[1024px] p-0 text-sm font-medium text-slate-700",children:e.jsxs(L,{children:[e.jsx(W,{placeholder:"Search Items..."}),e.jsx(H,{children:"No match found"}),e.jsx(E,{className:"max-h-[300px] overflow-y-scroll",children:e.jsx(V,{children:e.jsx(Ps,{isOpen:n})})})]})})]})},Rs=()=>{var r;const{returnInvoice:s,handleSubmit:n,isSubmitting:l}=R();return e.jsx(k,{variant:"default",disabled:l||!s.return_items||((r=s.return_items)==null?void 0:r.length)===0,onClick:()=>{n().then(x=>{F.success(x)}).catch(x=>{F.error(x)})},children:l?"Submitting...":"Submit Return"})},je="Checkbox",[Ts,Js]=We(je),[zs,Fs]=Ts(je),Es=c.forwardRef((s,n)=>{const{__scopeCheckbox:l,name:r,checked:x,defaultChecked:i,required:f,disabled:m,value:o="on",onCheckedChange:u,...p}=s,[d,h]=c.useState(null),P=He(n,b=>h(b)),_=c.useRef(!1),t=d?!!d.closest("form"):!0,[v=!1,j]=Ve({prop:x,defaultProp:i,onChange:u}),$=c.useRef(v);return c.useEffect(()=>{const b=d==null?void 0:d.form;if(b){const I=()=>j($.current);return b.addEventListener("reset",I),()=>b.removeEventListener("reset",I)}},[d,j]),c.createElement(zs,{scope:l,state:v,disabled:m},c.createElement(xe.button,Z({type:"button",role:"checkbox","aria-checked":z(v)?"mixed":v,"aria-required":f,"data-state":be(v),"data-disabled":m?"":void 0,disabled:m,value:o},p,{ref:P,onKeyDown:le(s.onKeyDown,b=>{b.key==="Enter"&&b.preventDefault()}),onClick:le(s.onClick,b=>{j(I=>z(I)?!0:!I),t&&(_.current=b.isPropagationStopped(),_.current||b.stopPropagation())})})),t&&c.createElement(Os,{control:d,bubbles:!_.current,name:r,value:o,checked:v,required:f,disabled:m,style:{transform:"translateX(-100%)"}}))}),ws="CheckboxIndicator",Ds=c.forwardRef((s,n)=>{const{__scopeCheckbox:l,forceMount:r,...x}=s,i=Fs(ws,l);return c.createElement(Qe,{present:r||z(i.state)||i.state===!0},c.createElement(xe.span,Z({"data-state":be(i.state),"data-disabled":i.disabled?"":void 0},x,{ref:n,style:{pointerEvents:"none",...s.style}})))}),Os=s=>{const{control:n,checked:l,bubbles:r=!0,...x}=s,i=c.useRef(null),f=Ke(l),m=Ue(n);return c.useEffect(()=>{const o=i.current,u=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(u,"checked").set;if(f!==l&&d){const h=new Event("click",{bubbles:r});o.indeterminate=z(l),d.call(o,z(l)?!1:l),o.dispatchEvent(h)}},[f,l,r]),c.createElement("input",Z({type:"checkbox","aria-hidden":!0,defaultChecked:z(l)?!1:l},x,{tabIndex:-1,ref:i,style:{...s.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function z(s){return s==="indeterminate"}function be(s){return z(s)?"indeterminate":s?"checked":"unchecked"}const ve=Es,Ms=Ds,ge=c.forwardRef(({className:s,...n},l)=>e.jsx(ve,{ref:l,className:re("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:e.jsx(Ms,{className:re("flex items-center justify-center text-current"),children:e.jsx(Ye,{className:"h-4 w-4"})})}));ge.displayName=ve.displayName;const qs=()=>{const{returnInvoice:s,setReturnInvoice:n}=R();return e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(ge,{id:"cash-refund",checked:!!s.is_cash_refund,onCheckedChange:l=>{n(r=>({...r,is_cash_refund:Number(l)}))}}),e.jsx(A,{htmlFor:"cash-refund",children:"Cash refund"})]})},Bs=()=>{const[s,n]=c.useState("IVC01-"),{searchInvoice:l,returnableItems:r,returnInvoice:x}=R(),i=f=>{f.preventDefault(),l(s).then(m=>{F.success(m)}).catch(m=>{F.error(m)})};return e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:i,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row justify-between w-full gap-4",children:[e.jsx(T,{value:s,maxLength:15,onChange:f=>n(f.target.value)}),e.jsxs(k,{type:"submit",variant:x.invoice_id?"outline":"default",className:"flex items-center gap-2",children:[e.jsx(Ge,{size:16,strokeWidth:2.5}),"Search Invoice Code"]})]}),r.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center justify-between w-full gap-5 pb-4",children:[e.jsx($s,{}),e.jsxs("div",{className:"flex flex-row items-center gap-6",children:[e.jsx(qs,{}),e.jsx(Rs,{})]})]}),e.jsx(As,{})]})]})})},Ls=()=>{const{returnInvoice:s,updateQuantity:n,isSubmitting:l,removeReturnItem:r}=R();return[{id:"itemNumber",accessorKey:"id",header:()=>e.jsx("div",{className:"flex justify-center",children:"Item #"}),cell:({row:i})=>e.jsx("div",{className:"flex justify-center",children:i.index+1}),size:100},{accessorKey:"quantityPurchased",header:()=>e.jsx("div",{className:"flex justify-center",children:"QTY Purchased"}),size:50,cell:({row:i})=>e.jsx("div",{className:"flex ",children:i.original.quantity})},{accessorKey:"quantityReturn",header:()=>e.jsx("div",{className:"flex justify-center",children:"QTY To Return"}),size:100,cell:({row:i})=>{var f,m,o;return e.jsxs("div",{className:"flex w-full flex-row justify-center ",children:[e.jsx(k,{className:"rounded-sm bg-red-300 hover:bg-red-500 disabled:opacity-100",onClick:()=>{var u;n(i.original.id,(((u=s.return_items.find(p=>p.invoice_item_id===i.original.id))==null?void 0:u.quantity)??1)-1)},disabled:(((f=s.return_items.find(u=>u.invoice_item_id===i.original.id))==null?void 0:f.quantity)??1)===1||l,children:e.jsx("span",{children:"-"})}),e.jsx(T,{type:"number",min:1,className:"max-w-[100px]",readOnly:!0,value:((m=s.return_items.find(u=>u.invoice_item_id===i.original.id))==null?void 0:m.quantity)??1}),e.jsx(k,{className:"rounded-sm bg-slate-500 hover:bg-slate-700 disabled:bg-slate-200",onClick:()=>{var u;n(i.original.id,(((u=s.return_items.find(p=>p.invoice_item_id===i.original.id))==null?void 0:u.quantity)??1)+1)},disabled:i.original.quantity===(((o=s.return_items.find(u=>u.invoice_item_id===i.original.id))==null?void 0:o.quantity)??1)||l,children:e.jsx("span",{children:"+"})})]})}},{accessorKey:"product.name",size:100,header:()=>e.jsx("div",{className:"justify-center",children:"Product"}),cell:({row:i})=>e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[i.original.product.brand&&e.jsxs("span",{className:"text-sm font-light",children:["(",i.original.product.brand,")"]}),e.jsx("span",{className:"text-sm font-bold",children:i.original.product.name}),"•",e.jsx("span",{className:"text-sm font-medium capitalize",children:i.original.product.size}),"•",e.jsx("span",{className:"text-sm font-bold uppercase",children:i.original.product.color})]})})},{accessorKey:"product_price",size:100,header:()=>e.jsx("div",{className:"justify-center",children:"Price"}),cell:({row:i})=>e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"flex flex-row gap-2",children:e.jsx("span",{className:"text-sm font-bold",children:U(i.original.product_price)})})})},{id:"actions",size:100,cell:({row:i})=>e.jsx("div",{className:"flex flex-row justify-center text-xs font-normal uppercase",children:e.jsx(k,{className:"bg-red-500 hover:bg-red-700",onClick:()=>{r(i.original.id)},children:e.jsx(ds,{color:"#FFF"})})})}]},Ws=({})=>{const{selectedItems:s}=R(),n=Ls();return e.jsx(e.Fragment,{children:s.length>0&&e.jsx("div",{children:e.jsx(he,{columns:n,data:s,filterWhat:"id",hideFilter:!0,hidePagination:s.length<10,dataType:"returnItems"})})})},Hs=()=>{const{returnInvoice:s}=R();return e.jsxs("div",{className:"flex w-full flex-row justify-end gap-8 border-t px-6 pt-2 text-base",children:[s.return_items&&e.jsxs("h3",{className:"space-x-2",children:[e.jsx("span",{className:"font-medium",children:"Total items:"}),e.jsx("span",{className:"font-bold",children:s.return_items.length})]}),!!s.refundable_amount&&e.jsxs("h3",{className:"space-x-2",children:[e.jsx("span",{className:"font-medium",children:"Refundable amount:"}),e.jsx("span",{className:"font-bold",children:Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(s.refundable_amount)})]})]})},Vs=()=>{const{voucher:s,setVoucher:n,isVoucherDialogOpen:l,setIsVoucherDialogOpen:r}=R();return e.jsx(Xe,{open:l,children:e.jsxs(Je,{children:[e.jsx(Ze,{children:e.jsx(es,{className:"text-left",children:"Voucher generated"})}),e.jsxs("div",{className:"my-4 flex w-full flex-row justify-between gap-4",children:[e.jsxs("h4",{children:["Code: ",e.jsx("span",{className:"font-semibold",children:s==null?void 0:s.code})]}),e.jsxs("h5",{children:["Discount:"," ",Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format((s==null?void 0:s.discounted_price)??0)]})]}),e.jsx(ss,{onClick:()=>{n(void 0),r(!1)},children:"Close"})]})})},Zs=()=>{const s=J();return e.jsx(e.Fragment,{children:e.jsx(Ss,{children:e.jsxs("div",{className:"flex h-screen w-screen flex-row",children:[e.jsx(ee,{}),e.jsxs("div",{className:"flex max-h-full w-full flex-col gap-4 overflow-y-auto p-6 pt-12 text-slate-700",children:[e.jsxs("div",{className:"mx-auto w-full max-w-[1024px] space-y-6",children:[e.jsxs("div",{className:"flex w-full flex-row items-start justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Search Invoice Code to return items"}),e.jsxs(k,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{s(-1)},children:[e.jsx(G,{size:20,strokeWidth:2.5}),"Go Back"]})]}),e.jsx("div",{children:e.jsx(Bs,{})})]}),e.jsx(Ws,{}),e.jsx(Hs,{})]}),e.jsx(Vs,{})]})})})};export{Gs as AddProductPOSPage,Zs as ReturnItemsPosPage,Xs as SelectWarehousePos};
