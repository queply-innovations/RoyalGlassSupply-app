import{r as d,H as Ne,j as e,ae as _,n as E,aw as P,aW as M,aX as O,aY as q,bu as L,bv as W,as as V,bF as B,av as F,bG as D,bx as H,aM as R,B as ce,bL as se,bm as _e,bo as Ce,bp as te,bq as ke,br as Ie,bs as I,a3 as Se,a4 as $e,a5 as Pe,a6 as Re,a7 as Ae,a8 as ae,aL as z,R as Te,bM as ze,af as Y,bN as Fe,bO as ne,bC as Ee,cd as we,aI as Me,a2 as G,aN as Oe,ce as qe,bg as Le,bf as We,bl as ie,p as de,A as oe,cf as ue,cg as Be,ch as De,ci as He,cj as Qe,ck as xe,aR as X,cl as le,cm as Ke,cn as Ue,co as Ye,bX as re,C as Ve,b9 as Ge}from"./index-e221ff24.js";import{C as Q,c as me,g as Xe,a as Je,P as Ze,d as es,b as ss,M as ts,A as as,N as J,f as K,T as ns}from"./useInventoryProductCalculations-91174d52.js";import{P as is,D as he,u as ls,f as rs}from"./timeUtils-c323b797.js";import"./index-4206cffa.js";const pe=d.createContext(void 0),cs=({children:s})=>{const[n,l]=d.useState("main"),[c,x]=d.useState(),{data:a,isLoading:m}=Ne(),h={inventories:a,isInventoriesLoading:m,selectedInventory:c,setSelectedInventory:x,activeTab:n,setActiveTab:l};return e.jsx(pe.Provider,{value:h,children:s})};function w(){const s=d.useContext(pe);if(!s)throw new Error("useAddProductPos hook must be used within AddProductPosProvider");return s}const U=({title:s,subtitle:n,icon:l,onClick:c})=>e.jsxs(_,{className:"flex h-fit flex-1 flex-col gap-8 rounded-xl bg-gray-300 p-16 pb-12 text-slate-800 hover:text-white",onClick:c||(()=>{}),children:[l&&l,e.jsxs("span",{children:[e.jsx("p",{className:"text-lg font-bold",children:s}),n&&e.jsx("p",{className:"text-sm opacity-70",children:n})]})]}),ds=()=>{const{auth:s}=E(),{inventories:n,isInventoriesLoading:l,selectedInventory:c,setSelectedInventory:x}=w(),m=n.filter(u=>{var p;return(s==null?void 0:s.role)!=="admin"&&(s==null?void 0:s.role)!=="super_admin"?u.warehouse.code.includes(((p=s==null?void 0:s.role)==null?void 0:p.split("_")[1])??""):n}).sort((u,p)=>new Date(p.updated_at??p.created_at).getTime()-new Date(u.updated_at??u.created_at).getTime()),[h,o]=d.useState(!1);return e.jsxs("div",{className:"flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"inventory",className:"text-sm font-bold text-gray-600",children:"Inventory"}),e.jsxs(M,{open:h,onOpenChange:o,children:[e.jsx(O,{id:"inventory",name:"inventory",className:"relative w-full",asChild:!0,children:e.jsxs(_,{role:"combobox",className:"justify-between truncate bg-white text-sm font-bold text-slate-600",variant:"outline",children:[c?e.jsxs("div",{className:"flex items-center font-bold text-slate-600",children:[c.code,e.jsx("span",{className:"ml-1 text-xs opacity-80",children:" • "+c.type+" • "+c.date_received})]}):e.jsx("span",{children:"Select an inventory..."}),e.jsx(Q,{size:14,strokeWidth:2,className:"h-4 w-4 opacity-70"})]})}),e.jsx(q,{className:"w-[calc(100vw-170px)] max-w-[974px] p-0 text-sm font-medium text-slate-700",children:e.jsxs(L,{defaultValue:(c==null?void 0:c.code)||"",children:[e.jsx(W,{placeholder:"Inventory code..."}),l&&e.jsx("div",{className:"flex h-16 w-full items-center justify-center",children:e.jsx(V,{size:22,strokeWidth:2.5,className:"animate-spin text-slate-700/50"})}),e.jsx(B,{children:"No results found"}),e.jsx(F,{className:"max-h-[200px] overflow-y-scroll",children:e.jsx(D,{children:m&&m.map(u=>e.jsxs(H,{className:"cursor-pointer justify-between rounded-sm",value:u.code,onSelect:()=>{x(u),o(!1)},children:[e.jsx("span",{children:u.code}),e.jsx("span",{className:"text-xs font-semibold text-slate-600",children:u.type+" • "+u.date_received})]},u.id))})})]})})]})]})},os=({setInventoryProductsQueue:s,inventoryId:n,products:l,productsLoading:c,suppliers:x,suppliersLoading:a,currentId:m,handleNavigation:h,selectedProduct:o})=>{var C,k,Z,ee;const{auth:u}=E(),p=(C=u.role)==null?void 0:C.includes("admin"),{value:r,handleChange:f}=me(),[t,y]=d.useState(!1),[v,g]=d.useState(!1),[N,S]=d.useState(null);d.useEffect(()=>{f("inventory_id",n),f("unit","pcs"),p&&f("status",1),o&&(f("product_id",o.data.product_id),f("status",o.data.status),f("supplier_id",o.data.supplier_id),f("capital_price",o.data.capital_price),f("unit",o.data.unit),f("stocks_count",o.data.stocks_count),f("damage_count",o.data.damage_count),f("total_count",o.data.total_count)),!o&&!p&&f("capital_price",0)},[]);const[j,b]=d.useState();return d.useEffect(()=>{const i=Xe(r.stocks_count||0,r.damage_count||0);b(i),f("total_count",i)},[r.damage_count,r.stocks_count,j]),e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:i=>{i.preventDefault(),r.product_id===void 0?S("Please select a product first."):r.supplier_id===void 0?S("Please select a supplier first."):(s(o?$=>[...$.filter(ye=>ye.id!==o.id),{id:o.id,data:r}]:$=>[...$,{id:m+1,data:r}]),h())},children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsxs("div",{className:"mt-3 grid w-full grid-flow-row grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-8 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"product_id",className:"text-sm font-bold text-gray-600",children:"Product"}),e.jsxs(M,{open:t,onOpenChange:y,children:[e.jsx(O,{id:"product_id",className:"relative w-full",asChild:!0,autoFocus:!0,children:e.jsxs(_,{role:"combobox",className:"w-full justify-between text-sm font-bold text-slate-700",variant:"outline",children:[r.product_id?e.jsx(e.Fragment,{children:(()=>{const i=l.find($=>$.id===r.product_id);return e.jsxs("div",{className:"flex w-full flex-row items-baseline gap-4",children:[e.jsx("span",{children:i==null?void 0:i.name}),e.jsxs("div",{className:"flex gap-4 truncate text-xs font-semibold",children:[(i==null?void 0:i.brand)&&e.jsx("span",{children:`Brand: ${i==null?void 0:i.brand}`}),(i==null?void 0:i.size)&&e.jsx("span",{children:`Size: ${i==null?void 0:i.size}`}),(i==null?void 0:i.color)&&e.jsx("span",{children:`Color: ${i==null?void 0:i.color}`})]})]})})()}):e.jsx("span",{children:"Select a product..."}),e.jsx(Q,{size:14,strokeWidth:2,className:"h-4 w-4 opacity-70"})]})}),e.jsx(q,{className:`${p?"max-w-[966px]":"max-w-[640px]"} w-[calc(100vw-170px)] p-0 text-sm font-medium text-slate-700`,children:e.jsxs(L,{children:[e.jsx(W,{placeholder:"Product name or serial number..."}),c&&e.jsx("div",{className:"flex h-16 w-full items-center justify-center",children:e.jsx(V,{size:22,strokeWidth:2.5,className:"animate-spin text-slate-700/50"})}),e.jsx(B,{children:"No match found"}),e.jsx(F,{className:"max-h-[200px] overflow-y-scroll",children:e.jsx(D,{children:l.map((i,$)=>e.jsx(H,{className:"cursor-pointer justify-between rounded-sm border-b",value:i.id+"_"+i.name+"_"+i.serial_no,onSelect:()=>{f("product_id",i.id),y(!1)},children:`${i.name} • ${i.brand} • ${i.size} • ${i.color}`},$))})})]})})]})]}),e.jsxs("div",{className:"col-span-4 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"supplier_id",className:"text-sm font-bold text-gray-600",children:"Supplier"}),e.jsxs(M,{open:v,onOpenChange:g,children:[e.jsx(O,{id:"supplier_id",className:"relative w-full",asChild:!0,children:e.jsxs(_,{role:"combobox",className:"w-full justify-between text-sm font-bold text-slate-700",variant:"outline",children:[r.supplier_id?e.jsx(e.Fragment,{children:(()=>{const i=x.find($=>$.id===r.supplier_id);return e.jsxs("div",{className:"flex w-full items-baseline gap-4 capitalize",children:[e.jsx("span",{className:"max-w-full truncate",children:i==null?void 0:i.name}),e.jsx("span",{className:"font-baseline text-xs text-slate-700/50",children:i==null?void 0:i.address})]})})()}):e.jsx("span",{children:"Select a supplier..."}),e.jsx(Q,{size:14,strokeWidth:2,className:"h-4 w-4 opacity-70"})]})}),e.jsx(q,{className:"min-w-[477px] p-0 text-sm font-medium text-slate-700",children:e.jsxs(L,{children:[e.jsx(W,{placeholder:"Supplier name or address..."}),a&&e.jsx("div",{className:"flex h-16 w-full items-center justify-center",children:e.jsx(V,{size:22,strokeWidth:2.5,className:"animate-spin text-slate-700/50"})}),e.jsx(B,{children:"No match found"}),e.jsx(F,{className:"max-h-[200px] overflow-y-scroll",children:e.jsx(D,{children:x.map((i,$)=>e.jsxs(H,{className:"cursor-pointer justify-between rounded-sm",onSelect:()=>{f("supplier_id",i.id),g(!1)},children:[e.jsx("span",{children:i.name}),e.jsx("span",{className:"text-xs font-semibold text-slate-700/50",children:i.address})]},$))})})]})})]})]})]}),e.jsx("hr",{className:"my-2 h-px w-full border-0 bg-gray-200"}),e.jsxs("div",{className:"grid w-full grid-flow-row grid-cols-12 gap-3",children:[e.jsxs("div",{className:`relative flex flex-col justify-center gap-1 ${p?"col-span-6":"hidden"}`,children:[e.jsx(P,{htmlFor:"capital_price",className:"text-sm font-bold text-gray-600",children:"Capital price"}),e.jsx(R,{id:"capital_price",name:"capital_price",type:"number",min:0,step:.01,required:!0,className:"pl-8",placeholder:"0.00",disabled:!p,value:r.capital_price||"",onBlur:i=>{r.capital_price!==void 0&&(i.target.value=Number(i.target.value).toFixed(2))},onChange:i=>{f("capital_price",Number(Number(i.target.value).toFixed(2)))}}),e.jsx("span",{className:"absolute bottom-0 left-0 pb-[0.65rem] pl-3 text-sm font-semibold text-gray-500",children:"₱"})]}),e.jsxs("div",{className:`flex flex-col justify-center gap-1 ${p?"col-span-6":"col-span-3"}`,children:[e.jsx(P,{htmlFor:"unit",className:"text-sm font-bold text-gray-600",children:"Unit"}),e.jsx(R,{id:"unit",name:"unit",type:"text",maxLength:40,required:!0,value:r.unit||"",onChange:i=>f("unit",i.target.value)})]}),e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"stocks_count",className:"text-sm font-bold text-gray-600",children:"Stocks count"}),e.jsx(R,{id:"stocks_count",name:"stocks_count",type:"number",min:0,max:9999999,step:1,value:(k=r.stocks_count)==null?void 0:k.toFixed(0),required:!0,onChange:i=>{f("stocks_count",Number(Number(i.target.value).toFixed(0)))}})]}),e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"damage_count",className:"text-sm font-bold text-gray-600",children:"Damage count"}),e.jsx(R,{id:"damage_count",name:"damage_count",type:"number",min:0,max:r.stocks_count??0,step:1,required:!0,value:(Z=r.damage_count)==null?void 0:Z.toFixed(0),onChange:i=>f("damage_count",Number(Number(i.target.value).toFixed(0)))})]}),e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"total_count",className:"text-sm font-bold text-gray-600",children:"Total count"}),e.jsx(R,{id:"total_count",name:"total_count",type:"number",min:0,max:9999999,step:1,readOnly:!0,value:j??"0",className:`${j&&j<0&&"text-red-600"}`})]}),((ee=u.role)==null?void 0:ee.includes("admin"))&&e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"total_count",className:"text-sm font-bold text-gray-600",children:"Approve stocks"}),e.jsx(R,{id:"total_count",name:"total_count",type:"number",min:0,max:r.stocks_count??0,step:1,value:r.approved_stocks!==void 0?String(r.approved_stocks):"",onChange:i=>f("approved_stocks",i.target.value),onBlur:i=>{f("approved_stocks",Number(i.target.value))}})]})]}),e.jsx("div",{className:"flex w-full justify-between whitespace-nowrap pt-6",children:e.jsx("div",{className:"ml-auto flex flex-row gap-4",children:e.jsx(ce,{type:"submit",fill:"green",disabled:r.product_id===void 0||r.supplier_id===void 0,className:"max-w-fit flex-1 py-2 text-sm font-bold text-white disabled:cursor-not-allowed disabled:opacity-50",children:o?"Save changes":"Add item to queue"})})}),N&&e.jsx("div",{className:"flex w-full flex-row justify-center gap-4",children:e.jsx("p",{className:"text-sm font-bold text-red-600",children:N})})]})})})},us=["","Name","Brand","Size","Color","Supplier","Capital price","Unit","Stocks","Damaged","Total","Approved"],xs=({data:s,products:n,suppliers:l,handleEditItem:c,handleRemoveItem:x,handleSubmit:a})=>{const{auth:m}=E(),{setSelectedInventory:h}=w(),[o,u]=d.useState(!1),[p,r]=d.useState(null),f=async()=>{u(!0);const t=await a({action:"batch-add",data:s.map(v=>v==null?void 0:v.data)}).then(v=>{Array.isArray(v)&&v.length>0&&(z.success("Items added to inventory",{autoClose:5e3,closeButton:!0}),h(void 0))}).catch(()=>{z.error("Error adding items to inventory",{autoClose:5e3,closeButton:!0})});(Array.isArray(t)?t.filter(v=>v!==201):[]).length>0?r("Error adding items to inventory"):u(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsxs(F,{type:"always",className:"flex-1 rounded-md border border-gray-200 bg-white",style:{"--border":"216 12% 84%"},children:[s.length<=0&&e.jsx("div",{className:"absolute z-10 flex h-full w-full items-center justify-center",children:e.jsx("p",{className:"text-lg font-medium text-gray-500/50",children:"No items in queue"})}),e.jsx(se,{orientation:"horizontal",className:"z-50 h-3"}),e.jsx(se,{orientation:"vertical",className:"z-50 h-3",style:{"--border":"216 12% 84%"},asChild:!0}),e.jsxs(_e,{children:[e.jsx(Ce,{children:e.jsx(te,{id:"tHeaderRow",className:"hover:bg-white",children:us.map(t=>{var y;if(t!=="Capital price"||(y=m==null?void 0:m.role)!=null&&y.includes("admin"))return e.jsx(ke,{className:"whitespace-nowrap px-5 py-3 text-xs font-bold uppercase",children:t},t+"_head")})},"tHeaderRow")}),e.jsx(Ie,{className:"[&>*:nth-child(even)]:bg-white [&>*:nth-child(odd)]:bg-gray-50",children:s.length>0&&s.map(t=>{var y,v,g,N,S,j;return e.jsxs(te,{className:"text-sm font-medium text-gray-700",children:[e.jsx(I,{className:"p-3 pr-0",children:e.jsx("div",{className:"flex flex-row justify-center text-xs font-normal uppercase",children:e.jsxs(Se,{children:[e.jsx($e,{className:"overflow-clip rounded-full bg-gray-200/70 p-1.5 hover:bg-gray-300",children:e.jsx(Je,{size:16,strokeWidth:2.25})}),e.jsxs(Pe,{className:"relative z-50 w-44 bg-white font-medium",children:[e.jsx(Re,{children:"Actions"}),e.jsx(Ae,{className:"bg-gray-200"}),e.jsxs(ae,{onClick:()=>{t!=null&&t.id&&c(t)},className:"flex flex-row items-center gap-3 rounded-md p-2 hover:bg-gray-200",children:[e.jsx("span",{className:"flex w-6 items-center justify-center",children:e.jsx(Ze,{size:16,strokeWidth:2})}),e.jsx("span",{children:"Edit"})]},(t==null?void 0:t.id)+"edit"),e.jsxs(ae,{onClick:()=>{t!=null&&t.id&&x(t.id)},className:"flex flex-row items-center gap-3 rounded-md p-2 focus:bg-red-50 focus:text-red-700",children:[e.jsx("span",{className:"flex w-6 items-center justify-center",children:e.jsx(es,{size:16,strokeWidth:2})}),e.jsx("span",{children:"Remove"})]},(t==null?void 0:t.id)+"remove")]})]})})},(t==null?void 0:t.id)+"action"),e.jsx(I,{className:"max-w-[200px] truncate px-5 py-3",children:t!=null&&t.data.product_id?(y=n.find(b=>b.id===t.data.product_id))==null?void 0:y.name:t==null?void 0:t.data.product_id},(t==null?void 0:t.id)+"product_id"),e.jsx(I,{className:"max-w-[200px] truncate px-5 py-3",children:t!=null&&t.data.product_id?(v=n.find(b=>b.id===t.data.product_id))==null?void 0:v.brand:"No brand"},(t==null?void 0:t.id)+"product_brand"),e.jsx(I,{className:"max-w-[200px] truncate px-5 py-3",children:t!=null&&t.data.product_id?(g=n.find(b=>b.id===t.data.product_id))==null?void 0:g.size:"No data"},(t==null?void 0:t.id)+"product_size"),e.jsx(I,{className:"max-w-[200px] truncate px-5 py-3",children:t!=null&&t.data.product_id?(N=n.find(b=>b.id===t.data.product_id))==null?void 0:N.color:"No data"},(t==null?void 0:t.id)+"product_color"),e.jsx(I,{className:"max-w-[200px] truncate px-5 py-3",children:t!=null&&t.data.supplier_id?(S=l.find(b=>b.id===t.data.supplier_id))==null?void 0:S.name:t==null?void 0:t.data.supplier_id},(t==null?void 0:t.id)+"supplier_id"),((j=m==null?void 0:m.role)==null?void 0:j.includes("admin"))&&e.jsx(I,{className:"px-5 py-3",children:Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format((t==null?void 0:t.data.capital_price)||0)},(t==null?void 0:t.id)+"capital_price"),e.jsx(I,{className:"px-5 py-3",children:t==null?void 0:t.data.unit},(t==null?void 0:t.id)+"unit"),e.jsx(I,{className:"px-5 py-3",children:t==null?void 0:t.data.stocks_count},(t==null?void 0:t.id)+"stocks_count"),e.jsx(I,{className:"px-5 py-3",children:t==null?void 0:t.data.damage_count},(t==null?void 0:t.id)+"damage_count"),e.jsx(I,{className:"px-5 py-3",children:t==null?void 0:t.data.total_count},(t==null?void 0:t.id)+"total_count"),e.jsx(I,{className:"px-5 py-3",children:t==null?void 0:t.data.approved_stocks},(t==null?void 0:t.id)+"approved_stocks")]},(t==null?void 0:t.id)+"row")})})]})]}),e.jsxs("div",{className:"flex w-full justify-between whitespace-nowrap pt-6",children:[p&&e.jsx("div",{className:"flex w-full flex-row items-center justify-start gap-4",children:e.jsx("p",{className:"text-sm font-bold text-red-600",children:p})}),e.jsx("div",{className:"ml-auto flex flex-row gap-4",children:e.jsx(ce,{type:"submit",fill:"green",disabled:s.length<=0||o,className:"max-w-fit flex-1 py-2 text-sm font-bold text-white disabled:cursor-not-allowed disabled:opacity-50",onClick:t=>{t.preventDefault(),f()},children:s.length<=1?"Add item to inventory":`Add ${s.length} items to inventory`})})]})]})})},ms={hidden:{opacity:0,x:"-100%"},animate:{opacity:1,x:"0%",transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,x:"-100%",transition:{duration:.3,ease:"easeInOut"}}},hs={hidden:{opacity:0,x:"100%"},animate:{opacity:1,x:"0%",transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,x:"100%",transition:{duration:.3,ease:"easeInOut"}}},ps=({inventoryId:s})=>{const{auth:n}=E(),{data:l,isLoading:c}=Te(),{suppliers:x,isFetching:a}=ze(),{handleSubmit:m}=me(),[h,o]=d.useState([]),[u,p]=d.useState({});d.useEffect(()=>{o([])},[s]);const[r,f]=d.useState("main"),t=()=>{p({}),f(r==="main"?"form":"main")},y=g=>{p(g),f("form")},v=g=>{o(N=>N.filter(S=>S.id!==g))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:r==="main"?"ml-auto":"",children:e.jsx(_,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{t()},children:e.jsxs(e.Fragment,{children:[r==="main"?e.jsx(is,{size:20,strokeWidth:2.5}):e.jsx(Y,{size:20,strokeWidth:2.5}),r==="main"?"Add an item":"Back"]})})}),e.jsx("div",{className:`relative max-h-[65vh] min-w-[650px] overflow-x-clip transition-all duration-300 
					${r==="form"?n.role==="admin"||n.role==="super_admin"?"h-[340px] min-h-[340px]":"h-[260px] min-h-[260px]":"h-[65vh] min-h-[415px]"}`,children:e.jsx(Fe,{initial:!1,children:r==="main"?e.jsx(ne.div,{variants:ms,initial:"hidden",animate:"animate",exit:"exit",className:"absolute h-full w-full overflow-x-auto antialiased",children:e.jsx(xs,{data:h,products:l,suppliers:x,handleEditItem:y,handleRemoveItem:v,handleSubmit:m})},"main"):e.jsx(ne.div,{variants:hs,initial:"hidden",animate:"animate",exit:"exit",className:"absolute max-h-[642px] w-full p-1",children:e.jsx(os,{setInventoryProductsQueue:o,inventoryId:s,products:l,productsLoading:c,suppliers:x,suppliersLoading:a,currentId:h.reduce((g,N)=>N.id>g?N.id:g,0),handleNavigation:t,selectedProduct:Object.keys(u).length?u:void 0})},"form")})})]})})},fs=()=>{const{selectedInventory:s}=w();return e.jsxs("div",{className:"w-full space-y-4 rounded-lg border bg-white p-6",children:[e.jsx(ds,{}),s&&e.jsx(ps,{inventoryId:s.id})]})},js=()=>{const{setActiveTab:s}=w();return e.jsxs("div",{className:"mx-auto flex w-full flex-row items-center gap-4",children:[e.jsx(U,{title:"Register Product Item",subtitle:"Create new unique product...",icon:e.jsx(Ee,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>s("add_product")}),e.jsx(U,{title:"Inventory Product",subtitle:"Add existing products to inventory...",icon:e.jsx(we,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>s("select_inventory")})]})},bs=({openModal:s})=>{const{data:n,isLoading:l}=Me(),c=()=>{s({},"add")};return e.jsx("div",{className:"max-h-full w-full flex-1 rounded-lg border border-black/10 bg-white",children:e.jsx(he,{columns:ss,data:n.sort((x,a)=>a.id-x.id),filterWhat:"name",dataType:"Product",openModal:c,isLoading:l})})},vs=()=>{const{activeTab:s,setActiveTab:n}=w(),l=G(),{isOpen:c,openModal:x,closeModal:a}=ls(),[m,h]=d.useState(""),o=(u,p)=>{x(),h(p)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full flex-row items-start justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Add Product"}),e.jsxs(_,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{s==="main"?l("/pos/add-order"):n("main")},children:[e.jsx(Y,{size:20,strokeWidth:2.5}),s==="main"?"Go back":"Main menu"]})]}),(s==="main"||s===void 0)&&e.jsx(js,{}),s==="select_inventory"&&e.jsx(fs,{})," ",s==="add_product"&&e.jsx(bs,{openModal:o}),e.jsx("div",{children:e.jsx(ts,{isOpen:c,onClose:a,title:m==="add"?"Add Product":"Edit Product",children:e.jsx(e.Fragment,{children:m==="add"&&e.jsx(as,{onClose:a})})})})]})},Hs=()=>e.jsxs("div",{className:"flex h-screen w-screen flex-row",children:[e.jsx(J,{}),e.jsx(cs,{children:e.jsxs(Oe,{children:[e.jsx("div",{className:"max-h-full w-full overflow-y-auto p-6 pt-12 text-slate-700",children:e.jsx("div",{className:"mx-auto max-w-[1024px] space-y-6",children:e.jsx(vs,{})})}),e.jsx(qe,{})]})})]}),Qs=()=>{const{setSearchFilterItems:s}=Le(),{currentInvoicePos:n,setCurrentInvoicePos:l}=We(),c=G();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-screen w-screen flex-row",children:[e.jsx(J,{}),e.jsx("div",{className:"max-h-full w-full overflow-y-auto p-6 pt-12 text-slate-700",children:e.jsxs("div",{className:"mx-auto max-w-[1024px] space-y-6",children:[e.jsxs("div",{className:"flex w-full flex-row items-start justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Select Warehouse to start selling"}),e.jsxs(_,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{c(-3)},children:[e.jsx(Y,{size:20,strokeWidth:2.5}),"Go Back"]})]}),e.jsxs("div",{className:"mx-auto flex w-full flex-row items-center gap-4",children:[e.jsx(U,{title:"Select CDO Warehouse",subtitle:"Cdo available products",icon:e.jsx(ie,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>{s({warehouse_id:1}),l({...n,warehouse_id:1}),c("/pos/add-order")}}),e.jsx(U,{title:"Select Iligan Warehouse",subtitle:"Iligan available products",icon:e.jsx(ie,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>{s({warehouse_id:2}),l({...n,warehouse_id:2}),c("/pos/add-order")}})]})]})})]})})},gs=async s=>await de.post(oe.RETURN_TRANSACTIONS,s,{headers:ue()}).then(n=>n.data.data).catch(n=>{throw console.error("Error submitting return invoice:",n),n}),ys=async s=>await de.post(`${oe.RETURN_TRANSACTIONS}/searches-filters-sorts`,{search:{code:s}},{headers:ue()}).then(n=>n.data.data).catch(n=>{throw console.error("Error fetching return transaction by code:",n),n}),fe=d.createContext(void 0),Ns=({children:s})=>{const[n,l]=d.useState({}),[c,x]=d.useState(void 0),[a,m]=d.useState(),[h,o]=d.useState([]),[u,p]=d.useState([]),{auth:r}=E(),f=async j=>(l({}),x(void 0),o([]),p([]),await ys(`RET-${j}`).then(b=>{if(b.find(k=>k.code===`RET-${j}`))throw"Invoice already has return transaction history.";return Be(j).then(k=>(l({code:`RET-${k.code}`,invoice_id:k.id,issued_by:(r==null?void 0:r.user.id)||0,refundable_amount:0,refund_status:"done",is_cash_refund:0}),x(k),o(k.invoice_items),"Invoice found.")).catch(()=>{throw"Code not found. Please try again."})})),t=(j,b)=>{l(C=>({...C,return_items:C.return_items.map(k=>k.invoice_item_id===j?{...k,quantity:b}:k)}))};d.useEffect(()=>{if(n.return_items){const j=n.return_items.reduce((b,C)=>b+C.quantity*C.price,0);l(b=>({...b,refundable_amount:j}))}},[n.return_items]);const[y,v]=d.useState(!1),g=async()=>(v(!0),await gs(n).then(()=>(l({}),x(void 0),o([]),p([]),v(!1),"Items successfully returned.")).catch(()=>{throw v(!1),"Failed to return items. Please try again."})),N=j=>{p(b=>b.filter(C=>C.id!==j)),l(b=>({...b,return_items:b.return_items.filter(C=>C.invoice_item_id!==j)}))};d.useEffect(()=>{console.log("items",n.return_items),console.log("selected items",u)},[n.return_items,u]);const S={returnInvoice:n,setReturnInvoice:l,invoiceCode:a,setInvoiceCode:m,returnableItems:h,setReturnableItems:o,searchInvoice:f,selectedInvoice:c,setSelectedInvoice:x,selectedItems:u,setSelectedItems:p,updateQuantity:t,handleSubmit:g,isSubmitting:y,setIsSubmitting:v,removeReturnItem:N};return e.jsx(fe.Provider,{value:S,children:s})};function A(){const s=d.useContext(fe);if(!s)throw new Error("useReturnInvoice must be used within ReturnInvoiceProvider");return s}const _s=()=>{const{selectedInvoice:s}=A();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Customer: "}),e.jsxs("span",{className:"font-medium capitalize",children:[s==null?void 0:s.customer.firstname," ",s==null?void 0:s.customer.lastname]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Created at: "}),e.jsx("span",{className:"font-medium capitalize",children:rs((s==null?void 0:s.created_at)??"")})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Paid Amount: "}),e.jsx("span",{className:"font-medium capitalize",children:K((s==null?void 0:s.paid_amount)??0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Total Amount: "}),e.jsx("span",{className:"font-medium capitalize",children:K((s==null?void 0:s.total_amount_due)??0)})]})]}),e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Total Items: "}),e.jsx("span",{className:"font-medium capitalize",children:s==null?void 0:s.invoice_items.length})]})})]})})},Cs=({isOpen:s})=>{const{returnableItems:n,returnInvoice:l,setReturnInvoice:c,setSelectedItems:x}=A();return console.log("Return Invoice Items:",n),e.jsx(e.Fragment,{children:n.map((a,m)=>e.jsx(H,{value:a.product.id+"_"+a.product.name+"_"+a.product.serial_no,className:`${l.return_items&&l.return_items.find(h=>h.invoice_item_id===a.id)?"hidden":""}`,onSelect:()=>{x(o=>[...o,a]);const h=[...l.return_items||[],{invoice_item_id:a.id,quantity:1,unit:a.unit,price:a.product_price,reason:"return"}];c(o=>({...o,return_items:h})),s(!1)},children:e.jsxs("div",{className:"flex w-full flex-row justify-between",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[a.product.brand&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-slate-500",children:["(",a.product.brand,")"]}),"•"]}),e.jsx("span",{className:"text-base font-bold",children:a.product.name}),"•",e.jsx("span",{className:"text-sm capitalize text-slate-500",children:a.product.size}),"•",e.jsx("span",{className:"text-sm capitalize text-slate-700",children:a.product.color})]}),e.jsxs("div",{className:"flex flex-row gap-3",children:[a.quantity>1?e.jsxs("span",{children:[a.quantity," pcs"]}):e.jsxs("span",{children:[a.quantity," pc"]}),e.jsx("span",{className:"font-bold",children:K(a.product_price)})]})]})},m))})},ks=({})=>{const[s,n]=d.useState(!1);return e.jsxs(M,{open:s,onOpenChange:n,children:[e.jsx(O,{asChild:!0,children:e.jsxs(_,{variant:"outline",role:"combobox","aria-expanded":s,className:"w-full justify-between",children:["Select Items...",e.jsx(Q,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(q,{className:"w-full min-w-[1024px] p-0 text-sm font-medium text-slate-700",children:e.jsxs(L,{children:[e.jsx(W,{placeholder:"Search Items..."}),e.jsx(B,{children:"No match found"}),e.jsx(F,{className:"max-h-[300px] overflow-y-scroll",children:e.jsx(D,{children:e.jsx(Cs,{isOpen:n})})})]})})]})},Is=()=>{var c;const{returnInvoice:s,handleSubmit:n,isSubmitting:l}=A();return e.jsx(_,{variant:"default",disabled:l||!s.return_items||((c=s.return_items)==null?void 0:c.length)===0,onClick:()=>{n().then(x=>{z.success(x)}).catch(x=>{z.error(x)})},children:l?"Submitting...":"Submit Return"})},je="Checkbox",[Ss,Ks]=De(je),[$s,Ps]=Ss(je),Rs=d.forwardRef((s,n)=>{const{__scopeCheckbox:l,name:c,checked:x,defaultChecked:a,required:m,disabled:h,value:o="on",onCheckedChange:u,...p}=s,[r,f]=d.useState(null),t=He(n,j=>f(j)),y=d.useRef(!1),v=r?!!r.closest("form"):!0,[g=!1,N]=Qe({prop:x,defaultProp:a,onChange:u}),S=d.useRef(g);return d.useEffect(()=>{const j=r==null?void 0:r.form;if(j){const b=()=>N(S.current);return j.addEventListener("reset",b),()=>j.removeEventListener("reset",b)}},[r,N]),d.createElement($s,{scope:l,state:g,disabled:h},d.createElement(xe.button,X({type:"button",role:"checkbox","aria-checked":T(g)?"mixed":g,"aria-required":m,"data-state":be(g),"data-disabled":h?"":void 0,disabled:h,value:o},p,{ref:t,onKeyDown:le(s.onKeyDown,j=>{j.key==="Enter"&&j.preventDefault()}),onClick:le(s.onClick,j=>{N(b=>T(b)?!0:!b),v&&(y.current=j.isPropagationStopped(),y.current||j.stopPropagation())})})),v&&d.createElement(zs,{control:r,bubbles:!y.current,name:c,value:o,checked:g,required:m,disabled:h,style:{transform:"translateX(-100%)"}}))}),As="CheckboxIndicator",Ts=d.forwardRef((s,n)=>{const{__scopeCheckbox:l,forceMount:c,...x}=s,a=Ps(As,l);return d.createElement(Ke,{present:c||T(a.state)||a.state===!0},d.createElement(xe.span,X({"data-state":be(a.state),"data-disabled":a.disabled?"":void 0},x,{ref:n,style:{pointerEvents:"none",...s.style}})))}),zs=s=>{const{control:n,checked:l,bubbles:c=!0,...x}=s,a=d.useRef(null),m=Ue(l),h=Ye(n);return d.useEffect(()=>{const o=a.current,u=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(u,"checked").set;if(m!==l&&r){const f=new Event("click",{bubbles:c});o.indeterminate=T(l),r.call(o,T(l)?!1:l),o.dispatchEvent(f)}},[m,l,c]),d.createElement("input",X({type:"checkbox","aria-hidden":!0,defaultChecked:T(l)?!1:l},x,{tabIndex:-1,ref:a,style:{...s.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function T(s){return s==="indeterminate"}function be(s){return T(s)?"indeterminate":s?"checked":"unchecked"}const ve=Rs,Fs=Ts,ge=d.forwardRef(({className:s,...n},l)=>e.jsx(ve,{ref:l,className:re("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...n,children:e.jsx(Fs,{className:re("flex items-center justify-center text-current"),children:e.jsx(Ve,{className:"h-4 w-4"})})}));ge.displayName=ve.displayName;const Es=()=>{const{returnInvoice:s,setReturnInvoice:n}=A();return e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(ge,{id:"cash-refund",checked:!!s.is_cash_refund,onCheckedChange:l=>{n(c=>({...c,is_cash_refund:Number(l)}))}}),e.jsx(P,{htmlFor:"cash-refund",children:"Cash refund"})]})},ws=()=>{const[s,n]=d.useState("IVC01-"),{searchInvoice:l,returnableItems:c,returnInvoice:x}=A(),a=m=>{m.preventDefault(),l(s).then(h=>{z.success(h)}).catch(h=>{z.error(h)})};return e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:a,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row justify-between w-full gap-4",children:[e.jsx(R,{value:s,maxLength:15,onChange:m=>n(m.target.value)}),e.jsxs(_,{type:"submit",variant:x.invoice_id?"outline":"default",className:"flex items-center gap-2",children:[e.jsx(Ge,{size:16,strokeWidth:2.5}),"Search Invoice Code"]})]}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center justify-between w-full gap-5 pb-4",children:[e.jsx(_s,{}),e.jsxs("div",{className:"flex flex-row items-center gap-6",children:[e.jsx(Es,{}),e.jsx(Is,{})]})]}),e.jsx(ks,{})]})]})})},Ms=()=>{const{returnInvoice:s,updateQuantity:n,isSubmitting:l,removeReturnItem:c}=A();return[{id:"itemNumber",accessorKey:"id",header:()=>e.jsx("div",{className:"flex justify-center",children:"Item #"}),cell:({row:a})=>e.jsx("div",{className:"flex justify-center",children:a.index+1}),size:100},{accessorKey:"quantityPurchased",header:()=>e.jsx("div",{className:"flex justify-center",children:"QTY Purchased"}),size:50,cell:({row:a})=>e.jsx("div",{className:"flex ",children:a.original.quantity})},{accessorKey:"quantityReturn",header:()=>e.jsx("div",{className:"flex justify-center",children:"QTY To Return"}),size:100,cell:({row:a})=>{var m,h,o;return e.jsxs("div",{className:"flex w-full flex-row justify-center ",children:[e.jsx(_,{className:"rounded-sm bg-red-300 hover:bg-red-500 disabled:opacity-100",onClick:()=>{var u;n(a.original.id,(((u=s.return_items.find(p=>p.invoice_item_id===a.original.id))==null?void 0:u.quantity)??1)-1)},disabled:(((m=s.return_items.find(u=>u.invoice_item_id===a.original.id))==null?void 0:m.quantity)??1)===1||l,children:e.jsx("span",{children:"-"})}),e.jsx(R,{type:"number",min:1,className:"max-w-[100px]",readOnly:!0,value:((h=s.return_items.find(u=>u.invoice_item_id===a.original.id))==null?void 0:h.quantity)??1}),e.jsx(_,{className:"rounded-sm bg-slate-500 hover:bg-slate-700 disabled:bg-slate-200",onClick:()=>{var u;n(a.original.id,(((u=s.return_items.find(p=>p.invoice_item_id===a.original.id))==null?void 0:u.quantity)??1)+1)},disabled:a.original.quantity===(((o=s.return_items.find(u=>u.invoice_item_id===a.original.id))==null?void 0:o.quantity)??1)||l,children:e.jsx("span",{children:"+"})})]})}},{accessorKey:"product.name",size:100,header:()=>e.jsx("div",{className:"justify-center",children:"Product"}),cell:({row:a})=>e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[a.original.product.brand&&e.jsxs("span",{className:"text-sm font-light",children:["(",a.original.product.brand,")"]}),e.jsx("span",{className:"text-sm font-bold",children:a.original.product.name}),"•",e.jsx("span",{className:"text-sm font-medium capitalize",children:a.original.product.size}),"•",e.jsx("span",{className:"text-sm font-bold uppercase",children:a.original.product.color})]})})},{accessorKey:"product_price",size:100,header:()=>e.jsx("div",{className:"justify-center",children:"Price"}),cell:({row:a})=>e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"flex flex-row gap-2",children:e.jsx("span",{className:"text-sm font-bold",children:K(a.original.product_price)})})})},{id:"actions",size:100,cell:({row:a})=>e.jsx("div",{className:"flex flex-row justify-center text-xs font-normal uppercase",children:e.jsx(_,{className:"bg-red-500 hover:bg-red-700",onClick:()=>{c(a.original.id)},children:e.jsx(ns,{color:"#FFF"})})})}]},Os=({})=>{const{selectedItems:s}=A(),n=Ms();return e.jsx(e.Fragment,{children:s.length>0&&e.jsx("div",{children:e.jsx(he,{columns:n,data:s,filterWhat:"id",hideFilter:!0,hidePagination:s.length<10,dataType:"returnItems"})})})},qs=()=>{const{returnInvoice:s}=A();return e.jsxs("div",{className:"flex w-full flex-row justify-end gap-8 border-t px-6 pt-2 text-base",children:[s.return_items&&e.jsxs("h3",{className:"space-x-2",children:[e.jsx("span",{className:"font-medium",children:"Total items:"}),e.jsx("span",{className:"font-bold",children:s.return_items.length})]}),!!s.refundable_amount&&e.jsxs("h3",{className:"space-x-2",children:[e.jsx("span",{className:"font-medium",children:"Refundable amount:"}),e.jsx("span",{className:"font-bold",children:Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(s.refundable_amount)})]})]})},Us=()=>{const s=G();return e.jsx(e.Fragment,{children:e.jsx(Ns,{children:e.jsxs("div",{className:"flex h-screen w-screen flex-row",children:[e.jsx(J,{}),e.jsxs("div",{className:"flex max-h-full w-full flex-col gap-4 overflow-y-auto p-6 pt-12 text-slate-700",children:[e.jsxs("div",{className:"mx-auto w-full max-w-[1024px] space-y-6",children:[e.jsxs("div",{className:"flex w-full flex-row items-start justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Search Invoice Code to return items"}),e.jsxs(_,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{s(-1)},children:[e.jsx(Y,{size:20,strokeWidth:2.5}),"Go Back"]})]}),e.jsx("div",{children:e.jsx(ws,{})})]}),e.jsx(Os,{}),e.jsx(qs,{})]})]})})})};export{Hs as AddProductPOSPage,Us as ReturnItemsPosPage,Qs as SelectWarehousePos};
