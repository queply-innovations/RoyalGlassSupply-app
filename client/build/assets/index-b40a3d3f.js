import{r as d,H as Ne,j as e,ae as C,n as E,aw as P,aW as M,aX as O,aY as q,bu as L,bv as W,as as V,bF as B,av as z,bG as D,bx as H,aM as R,B as ue,bL as ne,bm as _e,bo as Ce,bp as ie,bq as ke,br as Ie,bs as I,a3 as Se,a4 as $e,a5 as Pe,a6 as Re,a7 as Ae,a8 as le,aL as F,R as Te,bM as Fe,af as Y,bN as ze,bO as re,bC as Ee,cd as we,aI as Me,a2 as G,aN as Oe,ce as qe,bg as Le,bf as We,bl as ce,p as X,A as J,cf as Z,cg as Be,ch as De,ci as He,cj as Qe,ck as xe,aR as ee,cl as de,cm as Ue,cn as Ke,co as Ye,bX as oe,C as Ve,b9 as Ge}from"./index-8efc810c.js";import{C as Q,c as me,g as Xe,a as Je,P as Ze,d as et,b as tt,M as st,A as at,N as te,f as U,T as nt}from"./useInventoryProductCalculations-e2849a58.js";import{P as it,D as he,u as lt,f as rt}from"./timeUtils-d174f095.js";import"./index-04af4c37.js";const pe=d.createContext(void 0),ct=({children:t})=>{const[a,l]=d.useState("main"),[c,x]=d.useState(),{data:n,isLoading:m}=Ne(),p={inventories:n,isInventoriesLoading:m,selectedInventory:c,setSelectedInventory:x,activeTab:a,setActiveTab:l};return e.jsx(pe.Provider,{value:p,children:t})};function w(){const t=d.useContext(pe);if(!t)throw new Error("useAddProductPos hook must be used within AddProductPosProvider");return t}const K=({title:t,subtitle:a,icon:l,onClick:c})=>e.jsxs(C,{className:"flex h-fit flex-1 flex-col gap-8 rounded-xl bg-gray-300 p-16 pb-12 text-slate-800 hover:text-white",onClick:c||(()=>{}),children:[l&&l,e.jsxs("span",{children:[e.jsx("p",{className:"text-lg font-bold",children:t}),a&&e.jsx("p",{className:"text-sm opacity-70",children:a})]})]}),dt=()=>{const{auth:t}=E(),{inventories:a,isInventoriesLoading:l,selectedInventory:c,setSelectedInventory:x}=w(),m=a.filter(u=>{var f;return(t==null?void 0:t.role)!=="admin"&&(t==null?void 0:t.role)!=="super_admin"?u.warehouse.code.includes(((f=t==null?void 0:t.role)==null?void 0:f.split("_")[1])??""):a}).sort((u,f)=>new Date(f.updated_at??f.created_at).getTime()-new Date(u.updated_at??u.created_at).getTime()),[p,o]=d.useState(!1);return e.jsxs("div",{className:"flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"inventory",className:"text-sm font-bold text-gray-600",children:"Inventory"}),e.jsxs(M,{open:p,onOpenChange:o,children:[e.jsx(O,{id:"inventory",name:"inventory",className:"relative w-full",asChild:!0,children:e.jsxs(C,{role:"combobox",className:"justify-between truncate bg-white text-sm font-bold text-slate-600",variant:"outline",children:[c?e.jsxs("div",{className:"flex items-center font-bold text-slate-600",children:[c.code,e.jsx("span",{className:"ml-1 text-xs opacity-80",children:" • "+c.type+" • "+c.date_received})]}):e.jsx("span",{children:"Select an inventory..."}),e.jsx(Q,{size:14,strokeWidth:2,className:"h-4 w-4 opacity-70"})]})}),e.jsx(q,{className:"w-[calc(100vw-170px)] max-w-[974px] p-0 text-sm font-medium text-slate-700",children:e.jsxs(L,{defaultValue:(c==null?void 0:c.code)||"",children:[e.jsx(W,{placeholder:"Inventory code..."}),l&&e.jsx("div",{className:"flex h-16 w-full items-center justify-center",children:e.jsx(V,{size:22,strokeWidth:2.5,className:"animate-spin text-slate-700/50"})}),e.jsx(B,{children:"No results found"}),e.jsx(z,{className:"max-h-[200px] overflow-y-scroll",children:e.jsx(D,{children:m&&m.map(u=>e.jsxs(H,{className:"cursor-pointer justify-between rounded-sm",value:u.code,onSelect:()=>{x(u),o(!1)},children:[e.jsx("span",{children:u.code}),e.jsx("span",{className:"text-xs font-semibold text-slate-600",children:u.type+" • "+u.date_received})]},u.id))})})]})})]})]})},ot=({setInventoryProductsQueue:t,inventoryId:a,products:l,productsLoading:c,suppliers:x,suppliersLoading:n,currentId:m,handleNavigation:p,selectedProduct:o})=>{var _,k,se,ae;const{auth:u}=E(),f=(_=u.role)==null?void 0:_.includes("admin"),{value:r,handleChange:j}=me(),[s,y]=d.useState(!1),[v,g]=d.useState(!1),[N,S]=d.useState(null);d.useEffect(()=>{j("inventory_id",a),j("unit","pcs"),f&&j("status",1),o&&(j("product_id",o.data.product_id),j("status",o.data.status),j("supplier_id",o.data.supplier_id),j("capital_price",o.data.capital_price),j("unit",o.data.unit),j("stocks_count",o.data.stocks_count),j("damage_count",o.data.damage_count),j("total_count",o.data.total_count)),!o&&!f&&j("capital_price",0)},[]);const[b,h]=d.useState();return d.useEffect(()=>{const i=Xe(r.stocks_count||0,r.damage_count||0);h(i),j("total_count",i)},[r.damage_count,r.stocks_count,b]),e.jsx(e.Fragment,{children:e.jsx("form",{onSubmit:i=>{i.preventDefault(),r.product_id===void 0?S("Please select a product first."):r.supplier_id===void 0?S("Please select a supplier first."):(t(o?$=>[...$.filter(ye=>ye.id!==o.id),{id:o.id,data:r}]:$=>[...$,{id:m+1,data:r}]),p())},children:e.jsxs("div",{className:"flex w-full flex-col gap-3",children:[e.jsxs("div",{className:"mt-3 grid w-full grid-flow-row grid-cols-12 gap-3",children:[e.jsxs("div",{className:"col-span-8 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"product_id",className:"text-sm font-bold text-gray-600",children:"Product"}),e.jsxs(M,{open:s,onOpenChange:y,children:[e.jsx(O,{id:"product_id",className:"relative w-full",asChild:!0,autoFocus:!0,children:e.jsxs(C,{role:"combobox",className:"w-full justify-between text-sm font-bold text-slate-700",variant:"outline",children:[r.product_id?e.jsx(e.Fragment,{children:(()=>{const i=l.find($=>$.id===r.product_id);return e.jsxs("div",{className:"flex w-full flex-row items-baseline gap-4",children:[e.jsx("span",{children:i==null?void 0:i.name}),e.jsxs("div",{className:"flex gap-4 truncate text-xs font-semibold",children:[(i==null?void 0:i.brand)&&e.jsx("span",{children:`Brand: ${i==null?void 0:i.brand}`}),(i==null?void 0:i.size)&&e.jsx("span",{children:`Size: ${i==null?void 0:i.size}`}),(i==null?void 0:i.color)&&e.jsx("span",{children:`Color: ${i==null?void 0:i.color}`})]})]})})()}):e.jsx("span",{children:"Select a product..."}),e.jsx(Q,{size:14,strokeWidth:2,className:"h-4 w-4 opacity-70"})]})}),e.jsx(q,{className:`${f?"max-w-[966px]":"max-w-[640px]"} w-[calc(100vw-170px)] p-0 text-sm font-medium text-slate-700`,children:e.jsxs(L,{children:[e.jsx(W,{placeholder:"Product name or serial number..."}),c&&e.jsx("div",{className:"flex h-16 w-full items-center justify-center",children:e.jsx(V,{size:22,strokeWidth:2.5,className:"animate-spin text-slate-700/50"})}),e.jsx(B,{children:"No match found"}),e.jsx(z,{className:"max-h-[200px] overflow-y-scroll",children:e.jsx(D,{children:l.map((i,$)=>e.jsx(H,{className:"cursor-pointer justify-between rounded-sm border-b",value:i.id+"_"+i.name+"_"+i.serial_no,onSelect:()=>{j("product_id",i.id),y(!1)},children:`${i.name} • ${i.brand} • ${i.size} • ${i.color}`},$))})})]})})]})]}),e.jsxs("div",{className:"col-span-4 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"supplier_id",className:"text-sm font-bold text-gray-600",children:"Supplier"}),e.jsxs(M,{open:v,onOpenChange:g,children:[e.jsx(O,{id:"supplier_id",className:"relative w-full",asChild:!0,children:e.jsxs(C,{role:"combobox",className:"w-full justify-between text-sm font-bold text-slate-700",variant:"outline",children:[r.supplier_id?e.jsx(e.Fragment,{children:(()=>{const i=x.find($=>$.id===r.supplier_id);return e.jsxs("div",{className:"flex w-full items-baseline gap-4 capitalize",children:[e.jsx("span",{className:"max-w-full truncate",children:i==null?void 0:i.name}),e.jsx("span",{className:"font-baseline text-xs text-slate-700/50",children:i==null?void 0:i.address})]})})()}):e.jsx("span",{children:"Select a supplier..."}),e.jsx(Q,{size:14,strokeWidth:2,className:"h-4 w-4 opacity-70"})]})}),e.jsx(q,{className:"min-w-[477px] p-0 text-sm font-medium text-slate-700",children:e.jsxs(L,{children:[e.jsx(W,{placeholder:"Supplier name or address..."}),n&&e.jsx("div",{className:"flex h-16 w-full items-center justify-center",children:e.jsx(V,{size:22,strokeWidth:2.5,className:"animate-spin text-slate-700/50"})}),e.jsx(B,{children:"No match found"}),e.jsx(z,{className:"max-h-[200px] overflow-y-scroll",children:e.jsx(D,{children:x.map((i,$)=>e.jsxs(H,{className:"cursor-pointer justify-between rounded-sm",onSelect:()=>{j("supplier_id",i.id),g(!1)},children:[e.jsx("span",{children:i.name}),e.jsx("span",{className:"text-xs font-semibold text-slate-700/50",children:i.address})]},$))})})]})})]})]})]}),e.jsx("hr",{className:"my-2 h-px w-full border-0 bg-gray-200"}),e.jsxs("div",{className:"grid w-full grid-flow-row grid-cols-12 gap-3",children:[e.jsxs("div",{className:`relative flex flex-col justify-center gap-1 ${f?"col-span-6":"hidden"}`,children:[e.jsx(P,{htmlFor:"capital_price",className:"text-sm font-bold text-gray-600",children:"Capital price"}),e.jsx(R,{id:"capital_price",name:"capital_price",type:"number",min:0,step:.01,required:!0,className:"pl-8",placeholder:"0.00",disabled:!f,value:r.capital_price||"",onBlur:i=>{r.capital_price!==void 0&&(i.target.value=Number(i.target.value).toFixed(2))},onChange:i=>{j("capital_price",Number(Number(i.target.value).toFixed(2)))}}),e.jsx("span",{className:"absolute bottom-0 left-0 pb-[0.65rem] pl-3 text-sm font-semibold text-gray-500",children:"₱"})]}),e.jsxs("div",{className:`flex flex-col justify-center gap-1 ${f?"col-span-6":"col-span-3"}`,children:[e.jsx(P,{htmlFor:"unit",className:"text-sm font-bold text-gray-600",children:"Unit"}),e.jsx(R,{id:"unit",name:"unit",type:"text",maxLength:40,required:!0,value:r.unit||"",onChange:i=>j("unit",i.target.value)})]}),e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"stocks_count",className:"text-sm font-bold text-gray-600",children:"Stocks count"}),e.jsx(R,{id:"stocks_count",name:"stocks_count",type:"number",min:0,max:9999999,step:1,value:(k=r.stocks_count)==null?void 0:k.toFixed(0),required:!0,onChange:i=>{j("stocks_count",Number(Number(i.target.value).toFixed(0)))}})]}),e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"damage_count",className:"text-sm font-bold text-gray-600",children:"Damage count"}),e.jsx(R,{id:"damage_count",name:"damage_count",type:"number",min:0,max:r.stocks_count??0,step:1,required:!0,value:(se=r.damage_count)==null?void 0:se.toFixed(0),onChange:i=>j("damage_count",Number(Number(i.target.value).toFixed(0)))})]}),e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"total_count",className:"text-sm font-bold text-gray-600",children:"Total count"}),e.jsx(R,{id:"total_count",name:"total_count",type:"number",min:0,max:9999999,step:1,readOnly:!0,value:b??"0",className:`${b&&b<0&&"text-red-600"}`})]}),((ae=u.role)==null?void 0:ae.includes("admin"))&&e.jsxs("div",{className:"col-span-3 flex flex-col justify-center gap-1",children:[e.jsx(P,{htmlFor:"total_count",className:"text-sm font-bold text-gray-600",children:"Approve stocks"}),e.jsx(R,{id:"total_count",name:"total_count",type:"number",min:0,max:r.stocks_count??0,step:1,value:r.approved_stocks!==void 0?String(r.approved_stocks):"",onChange:i=>j("approved_stocks",i.target.value),onBlur:i=>{j("approved_stocks",Number(i.target.value))}})]})]}),e.jsx("div",{className:"flex w-full justify-between whitespace-nowrap pt-6",children:e.jsx("div",{className:"ml-auto flex flex-row gap-4",children:e.jsx(ue,{type:"submit",fill:"green",disabled:r.product_id===void 0||r.supplier_id===void 0,className:"max-w-fit flex-1 py-2 text-sm font-bold text-white disabled:cursor-not-allowed disabled:opacity-50",children:o?"Save changes":"Add item to queue"})})}),N&&e.jsx("div",{className:"flex w-full flex-row justify-center gap-4",children:e.jsx("p",{className:"text-sm font-bold text-red-600",children:N})})]})})})},ut=["","Name","Brand","Size","Color","Supplier","Capital price","Unit","Stocks","Damaged","Total","Approved"],xt=({data:t,products:a,suppliers:l,handleEditItem:c,handleRemoveItem:x,handleSubmit:n})=>{const{auth:m}=E(),{setSelectedInventory:p}=w(),[o,u]=d.useState(!1),[f,r]=d.useState(null),j=async()=>{u(!0);const s=await n({action:"batch-add",data:t.map(v=>v==null?void 0:v.data)}).then(v=>{Array.isArray(v)&&v.length>0&&(F.success("Items added to inventory",{autoClose:5e3,closeButton:!0}),p(void 0))}).catch(()=>{F.error("Error adding items to inventory",{autoClose:5e3,closeButton:!0})});(Array.isArray(s)?s.filter(v=>v!==201):[]).length>0?r("Error adding items to inventory"):u(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"relative flex h-full flex-col",children:[e.jsxs(z,{type:"always",className:"flex-1 rounded-md border border-gray-200 bg-white",style:{"--border":"216 12% 84%"},children:[t.length<=0&&e.jsx("div",{className:"absolute z-10 flex h-full w-full items-center justify-center",children:e.jsx("p",{className:"text-lg font-medium text-gray-500/50",children:"No items in queue"})}),e.jsx(ne,{orientation:"horizontal",className:"z-50 h-3"}),e.jsx(ne,{orientation:"vertical",className:"z-50 h-3",style:{"--border":"216 12% 84%"},asChild:!0}),e.jsxs(_e,{children:[e.jsx(Ce,{children:e.jsx(ie,{id:"tHeaderRow",className:"hover:bg-white",children:ut.map(s=>{var y;if(s!=="Capital price"||(y=m==null?void 0:m.role)!=null&&y.includes("admin"))return e.jsx(ke,{className:"whitespace-nowrap px-5 py-3 text-xs font-bold uppercase",children:s},s+"_head")})},"tHeaderRow")}),e.jsx(Ie,{className:"[&>*:nth-child(even)]:bg-white [&>*:nth-child(odd)]:bg-gray-50",children:t.length>0&&t.map(s=>{var y,v,g,N,S,b;return e.jsxs(ie,{className:"text-sm font-medium text-gray-700",children:[e.jsx(I,{className:"p-3 pr-0",children:e.jsx("div",{className:"flex flex-row justify-center text-xs font-normal uppercase",children:e.jsxs(Se,{children:[e.jsx($e,{className:"overflow-clip rounded-full bg-gray-200/70 p-1.5 hover:bg-gray-300",children:e.jsx(Je,{size:16,strokeWidth:2.25})}),e.jsxs(Pe,{className:"relative z-50 w-44 bg-white font-medium",children:[e.jsx(Re,{children:"Actions"}),e.jsx(Ae,{className:"bg-gray-200"}),e.jsxs(le,{onClick:()=>{s!=null&&s.id&&c(s)},className:"flex flex-row items-center gap-3 rounded-md p-2 hover:bg-gray-200",children:[e.jsx("span",{className:"flex w-6 items-center justify-center",children:e.jsx(Ze,{size:16,strokeWidth:2})}),e.jsx("span",{children:"Edit"})]},(s==null?void 0:s.id)+"edit"),e.jsxs(le,{onClick:()=>{s!=null&&s.id&&x(s.id)},className:"flex flex-row items-center gap-3 rounded-md p-2 focus:bg-red-50 focus:text-red-700",children:[e.jsx("span",{className:"flex w-6 items-center justify-center",children:e.jsx(et,{size:16,strokeWidth:2})}),e.jsx("span",{children:"Remove"})]},(s==null?void 0:s.id)+"remove")]})]})})},(s==null?void 0:s.id)+"action"),e.jsx(I,{className:"max-w-[200px] truncate px-5 py-3",children:s!=null&&s.data.product_id?(y=a.find(h=>h.id===s.data.product_id))==null?void 0:y.name:s==null?void 0:s.data.product_id},(s==null?void 0:s.id)+"product_id"),e.jsx(I,{className:"max-w-[200px] truncate px-5 py-3",children:s!=null&&s.data.product_id?(v=a.find(h=>h.id===s.data.product_id))==null?void 0:v.brand:"No brand"},(s==null?void 0:s.id)+"product_brand"),e.jsx(I,{className:"max-w-[200px] truncate px-5 py-3",children:s!=null&&s.data.product_id?(g=a.find(h=>h.id===s.data.product_id))==null?void 0:g.size:"No data"},(s==null?void 0:s.id)+"product_size"),e.jsx(I,{className:"max-w-[200px] truncate px-5 py-3",children:s!=null&&s.data.product_id?(N=a.find(h=>h.id===s.data.product_id))==null?void 0:N.color:"No data"},(s==null?void 0:s.id)+"product_color"),e.jsx(I,{className:"max-w-[200px] truncate px-5 py-3",children:s!=null&&s.data.supplier_id?(S=l.find(h=>h.id===s.data.supplier_id))==null?void 0:S.name:s==null?void 0:s.data.supplier_id},(s==null?void 0:s.id)+"supplier_id"),((b=m==null?void 0:m.role)==null?void 0:b.includes("admin"))&&e.jsx(I,{className:"px-5 py-3",children:Intl.NumberFormat("en-US",{style:"currency",currency:"PHP"}).format((s==null?void 0:s.data.capital_price)||0)},(s==null?void 0:s.id)+"capital_price"),e.jsx(I,{className:"px-5 py-3",children:s==null?void 0:s.data.unit},(s==null?void 0:s.id)+"unit"),e.jsx(I,{className:"px-5 py-3",children:s==null?void 0:s.data.stocks_count},(s==null?void 0:s.id)+"stocks_count"),e.jsx(I,{className:"px-5 py-3",children:s==null?void 0:s.data.damage_count},(s==null?void 0:s.id)+"damage_count"),e.jsx(I,{className:"px-5 py-3",children:s==null?void 0:s.data.total_count},(s==null?void 0:s.id)+"total_count"),e.jsx(I,{className:"px-5 py-3",children:s==null?void 0:s.data.approved_stocks},(s==null?void 0:s.id)+"approved_stocks")]},(s==null?void 0:s.id)+"row")})})]})]}),e.jsxs("div",{className:"flex w-full justify-between whitespace-nowrap pt-6",children:[f&&e.jsx("div",{className:"flex w-full flex-row items-center justify-start gap-4",children:e.jsx("p",{className:"text-sm font-bold text-red-600",children:f})}),e.jsx("div",{className:"ml-auto flex flex-row gap-4",children:e.jsx(ue,{type:"submit",fill:"green",disabled:t.length<=0||o,className:"max-w-fit flex-1 py-2 text-sm font-bold text-white disabled:cursor-not-allowed disabled:opacity-50",onClick:s=>{s.preventDefault(),j()},children:t.length<=1?"Add item to inventory":`Add ${t.length} items to inventory`})})]})]})})},mt={hidden:{opacity:0,x:"-100%"},animate:{opacity:1,x:"0%",transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,x:"-100%",transition:{duration:.3,ease:"easeInOut"}}},ht={hidden:{opacity:0,x:"100%"},animate:{opacity:1,x:"0%",transition:{duration:.3,ease:"easeInOut"}},exit:{opacity:0,x:"100%",transition:{duration:.3,ease:"easeInOut"}}},pt=({inventoryId:t})=>{const{auth:a}=E(),{data:l,isLoading:c}=Te(),{suppliers:x,isFetching:n}=Fe(),{handleSubmit:m}=me(),[p,o]=d.useState([]),[u,f]=d.useState({});d.useEffect(()=>{o([])},[t]);const[r,j]=d.useState("main"),s=()=>{f({}),j(r==="main"?"form":"main")},y=g=>{f(g),j("form")},v=g=>{o(N=>N.filter(S=>S.id!==g))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("div",{className:r==="main"?"ml-auto":"",children:e.jsx(C,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{s()},children:e.jsxs(e.Fragment,{children:[r==="main"?e.jsx(it,{size:20,strokeWidth:2.5}):e.jsx(Y,{size:20,strokeWidth:2.5}),r==="main"?"Add an item":"Back"]})})}),e.jsx("div",{className:`relative max-h-[65vh] min-w-[650px] overflow-x-clip transition-all duration-300 
					${r==="form"?a.role==="admin"||a.role==="super_admin"?"h-[340px] min-h-[340px]":"h-[260px] min-h-[260px]":"h-[65vh] min-h-[415px]"}`,children:e.jsx(ze,{initial:!1,children:r==="main"?e.jsx(re.div,{variants:mt,initial:"hidden",animate:"animate",exit:"exit",className:"absolute h-full w-full overflow-x-auto antialiased",children:e.jsx(xt,{data:p,products:l,suppliers:x,handleEditItem:y,handleRemoveItem:v,handleSubmit:m})},"main"):e.jsx(re.div,{variants:ht,initial:"hidden",animate:"animate",exit:"exit",className:"absolute max-h-[642px] w-full p-1",children:e.jsx(ot,{setInventoryProductsQueue:o,inventoryId:t,products:l,productsLoading:c,suppliers:x,suppliersLoading:n,currentId:p.reduce((g,N)=>N.id>g?N.id:g,0),handleNavigation:s,selectedProduct:Object.keys(u).length?u:void 0})},"form")})})]})})},ft=()=>{const{selectedInventory:t}=w();return e.jsxs("div",{className:"w-full space-y-4 rounded-lg border bg-white p-6",children:[e.jsx(dt,{}),t&&e.jsx(pt,{inventoryId:t.id})]})},jt=()=>{const{setActiveTab:t}=w();return e.jsxs("div",{className:"mx-auto flex w-full flex-row items-center gap-4",children:[e.jsx(K,{title:"Register Product Item",subtitle:"Create new unique product...",icon:e.jsx(Ee,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>t("add_product")}),e.jsx(K,{title:"Inventory Product",subtitle:"Add existing products to inventory...",icon:e.jsx(we,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>t("select_inventory")})]})},bt=({openModal:t})=>{const{data:a,isLoading:l}=Me(),c=()=>{t({},"add")};return e.jsx("div",{className:"max-h-full w-full flex-1 rounded-lg border border-black/10 bg-white",children:e.jsx(he,{columns:tt,data:a.sort((x,n)=>n.id-x.id),filterWhat:"name",dataType:"Product",openModal:c,isLoading:l})})},vt=()=>{const{activeTab:t,setActiveTab:a}=w(),l=G(),{isOpen:c,openModal:x,closeModal:n}=lt(),[m,p]=d.useState(""),o=(u,f)=>{x(),p(f)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full flex-row items-start justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Add Product"}),e.jsxs(C,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{t==="main"?l("/pos/add-order"):a("main")},children:[e.jsx(Y,{size:20,strokeWidth:2.5}),t==="main"?"Go back":"Main menu"]})]}),(t==="main"||t===void 0)&&e.jsx(jt,{}),t==="select_inventory"&&e.jsx(ft,{})," ",t==="add_product"&&e.jsx(bt,{openModal:o}),e.jsx("div",{children:e.jsx(st,{isOpen:c,onClose:n,title:m==="add"?"Add Product":"Edit Product",children:e.jsx(e.Fragment,{children:m==="add"&&e.jsx(at,{onClose:n})})})})]})},Qt=()=>e.jsxs("div",{className:"flex h-screen w-screen flex-row",children:[e.jsx(te,{}),e.jsx(ct,{children:e.jsxs(Oe,{children:[e.jsx("div",{className:"max-h-full w-full overflow-y-auto p-6 pt-12 text-slate-700",children:e.jsx("div",{className:"mx-auto max-w-[1024px] space-y-6",children:e.jsx(vt,{})})}),e.jsx(qe,{})]})})]}),Ut=()=>{const{setSearchFilterItems:t}=Le(),{currentInvoicePos:a,setCurrentInvoicePos:l}=We(),c=G();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex h-screen w-screen flex-row",children:[e.jsx(te,{}),e.jsx("div",{className:"max-h-full w-full overflow-y-auto p-6 pt-12 text-slate-700",children:e.jsxs("div",{className:"mx-auto max-w-[1024px] space-y-6",children:[e.jsxs("div",{className:"flex w-full flex-row items-start justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Select Warehouse to start selling"}),e.jsxs(C,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{c(-3)},children:[e.jsx(Y,{size:20,strokeWidth:2.5}),"Go Back"]})]}),e.jsxs("div",{className:"mx-auto flex w-full flex-row items-center gap-4",children:[e.jsx(K,{title:"Select CDO Warehouse",subtitle:"Cdo available products",icon:e.jsx(ce,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>{t({warehouse_id:1}),l({...a,warehouse_id:1}),c("/pos/add-order")}}),e.jsx(K,{title:"Select Iligan Warehouse",subtitle:"Iligan available products",icon:e.jsx(ce,{size:20,strokeWidth:1.5,className:"h-16 w-16"}),onClick:()=>{t({warehouse_id:2}),l({...a,warehouse_id:2}),c("/pos/add-order")}})]})]})})]})})},gt=async t=>await X.post(J.RETURN_TRANSACTIONS,t,{headers:Z()}).then(a=>a.data.data).catch(a=>{throw console.error("Error submitting return invoice:",a),a}),yt=async t=>await X.post(J.RETURN_TRANSACTIONS_ITEMS,t,{headers:Z()}).then(a=>a.data.data).catch(a=>{throw console.error("Error submitting return invoice items:",a),a}),Nt=async t=>await X.post(`${J.RETURN_TRANSACTIONS}/searches-filters-sorts`,{search:{code:t}},{headers:Z()}).then(a=>a.data.data).catch(a=>{throw console.error("Error fetching return transaction by code:",a),a}),fe=d.createContext(void 0),_t=({children:t})=>{const[a,l]=d.useState({}),[c,x]=d.useState(void 0),[n,m]=d.useState(),[p,o]=d.useState([]),[u,f]=d.useState([]),{auth:r}=E(),j=async b=>(l({}),x(void 0),o([]),f([]),await Nt(`RET-${b}`).then(h=>{if(h.find(k=>k.code===`RET-${b}`))throw"Invoice already has return transaction history.";return Be(b).then(k=>(l({code:`RET-${k.code}`,invoice_id:k.id,issued_by:(r==null?void 0:r.user.id)||0,refundable_amount:0,refund_status:"done",is_cash_refund:0}),x(k),o(k.invoice_items),"Invoice found.")).catch(()=>{throw"Code not found. Please try again."})})),s=(b,h)=>{l(_=>({..._,return_items:_.return_items.map(k=>k.invoice_item_id===b?{...k,quantity:h}:k)}))};d.useEffect(()=>{if(a.return_items){const b=a.return_items.reduce((h,_)=>h+_.quantity*_.price,0);l(h=>({...h,refundable_amount:b}))}},[a.return_items]);const[y,v]=d.useState(!1),g=async()=>(v(!0),await gt(a).then(b=>{var h;return Promise.all((h=a.return_items)==null?void 0:h.map(async _=>{await yt({..._,return_transaction_id:b.id})})).then(()=>(l({}),x(void 0),o([]),f([]),v(!1),"Items successfully returned.")).catch(()=>{throw v(!1),"Failed to return items. Please try again."})}).catch(()=>{throw v(!1),"Failed to return items. Please try again."})),N=b=>{f(h=>h.filter(_=>_.id!==b)),l(h=>({...h,return_items:h.return_items.filter(_=>_.invoice_item_id!==b)}))};d.useEffect(()=>{console.log("items",a.return_items),console.log("selected items",u)},[a.return_items,u]);const S={returnInvoice:a,setReturnInvoice:l,invoiceCode:n,setInvoiceCode:m,returnableItems:p,setReturnableItems:o,searchInvoice:j,selectedInvoice:c,setSelectedInvoice:x,selectedItems:u,setSelectedItems:f,updateQuantity:s,handleSubmit:g,isSubmitting:y,setIsSubmitting:v,removeReturnItem:N};return e.jsx(fe.Provider,{value:S,children:t})};function A(){const t=d.useContext(fe);if(!t)throw new Error("useReturnInvoice must be used within ReturnInvoiceProvider");return t}const Ct=()=>{const{selectedInvoice:t}=A();return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-row gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Customer: "}),e.jsxs("span",{className:"font-medium capitalize",children:[t==null?void 0:t.customer.firstname," ",t==null?void 0:t.customer.lastname]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Created at: "}),e.jsx("span",{className:"font-medium capitalize",children:rt((t==null?void 0:t.created_at)??"")})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Paid Amount: "}),e.jsx("span",{className:"font-medium capitalize",children:U((t==null?void 0:t.paid_amount)??0)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Total Amount: "}),e.jsx("span",{className:"font-medium capitalize",children:U((t==null?void 0:t.total_amount_due)??0)})]})]}),e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{children:[e.jsx("span",{className:"font-bold",children:"Total Items: "}),e.jsx("span",{className:"font-medium capitalize",children:t==null?void 0:t.invoice_items.length})]})})]})})},kt=({isOpen:t})=>{const{returnableItems:a,returnInvoice:l,setReturnInvoice:c,setSelectedItems:x}=A();return console.log("Return Invoice Items:",a),e.jsx(e.Fragment,{children:a.map((n,m)=>e.jsx(H,{value:n.product.id+"_"+n.product.name+"_"+n.product.serial_no,className:`${l.return_items&&l.return_items.find(p=>p.invoice_item_id===n.id)?"hidden":""}`,onSelect:()=>{x(o=>[...o,n]);const p=[...l.return_items||[],{invoice_item_id:n.id,quantity:1,unit:n.unit,price:n.product_price,reason:"return"}];c(o=>({...o,return_items:p})),t(!1)},children:e.jsxs("div",{className:"flex w-full flex-row justify-between",children:[e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[n.product.brand&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"text-sm text-slate-500",children:["(",n.product.brand,")"]}),"•"]}),e.jsx("span",{className:"text-base font-bold",children:n.product.name}),"•",e.jsx("span",{className:"text-sm capitalize text-slate-500",children:n.product.size}),"•",e.jsx("span",{className:"text-sm capitalize text-slate-700",children:n.product.color})]}),e.jsxs("div",{className:"flex flex-row gap-3",children:[n.quantity>1?e.jsxs("span",{children:[n.quantity," pcs"]}):e.jsxs("span",{children:[n.quantity," pc"]}),e.jsx("span",{className:"font-bold",children:U(n.product_price)})]})]})},m))})},It=({})=>{const[t,a]=d.useState(!1);return e.jsxs(M,{open:t,onOpenChange:a,children:[e.jsx(O,{asChild:!0,children:e.jsxs(C,{variant:"outline",role:"combobox","aria-expanded":t,className:"w-full justify-between",children:["Select Items...",e.jsx(Q,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(q,{className:"w-full min-w-[1024px] p-0 text-sm font-medium text-slate-700",children:e.jsxs(L,{children:[e.jsx(W,{placeholder:"Search Items..."}),e.jsx(B,{children:"No match found"}),e.jsx(z,{className:"max-h-[300px] overflow-y-scroll",children:e.jsx(D,{children:e.jsx(kt,{isOpen:a})})})]})})]})},St=()=>{var c;const{returnInvoice:t,handleSubmit:a,isSubmitting:l}=A();return e.jsx(C,{variant:"default",disabled:l||!t.return_items||((c=t.return_items)==null?void 0:c.length)===0,onClick:()=>{a().then(x=>{F.success(x)}).catch(x=>{F.error(x)})},children:l?"Submitting...":"Submit Return"})},je="Checkbox",[$t,Kt]=De(je),[Pt,Rt]=$t(je),At=d.forwardRef((t,a)=>{const{__scopeCheckbox:l,name:c,checked:x,defaultChecked:n,required:m,disabled:p,value:o="on",onCheckedChange:u,...f}=t,[r,j]=d.useState(null),s=He(a,b=>j(b)),y=d.useRef(!1),v=r?!!r.closest("form"):!0,[g=!1,N]=Qe({prop:x,defaultProp:n,onChange:u}),S=d.useRef(g);return d.useEffect(()=>{const b=r==null?void 0:r.form;if(b){const h=()=>N(S.current);return b.addEventListener("reset",h),()=>b.removeEventListener("reset",h)}},[r,N]),d.createElement(Pt,{scope:l,state:g,disabled:p},d.createElement(xe.button,ee({type:"button",role:"checkbox","aria-checked":T(g)?"mixed":g,"aria-required":m,"data-state":be(g),"data-disabled":p?"":void 0,disabled:p,value:o},f,{ref:s,onKeyDown:de(t.onKeyDown,b=>{b.key==="Enter"&&b.preventDefault()}),onClick:de(t.onClick,b=>{N(h=>T(h)?!0:!h),v&&(y.current=b.isPropagationStopped(),y.current||b.stopPropagation())})})),v&&d.createElement(zt,{control:r,bubbles:!y.current,name:c,value:o,checked:g,required:m,disabled:p,style:{transform:"translateX(-100%)"}}))}),Tt="CheckboxIndicator",Ft=d.forwardRef((t,a)=>{const{__scopeCheckbox:l,forceMount:c,...x}=t,n=Rt(Tt,l);return d.createElement(Ue,{present:c||T(n.state)||n.state===!0},d.createElement(xe.span,ee({"data-state":be(n.state),"data-disabled":n.disabled?"":void 0},x,{ref:a,style:{pointerEvents:"none",...t.style}})))}),zt=t=>{const{control:a,checked:l,bubbles:c=!0,...x}=t,n=d.useRef(null),m=Ke(l),p=Ye(a);return d.useEffect(()=>{const o=n.current,u=window.HTMLInputElement.prototype,r=Object.getOwnPropertyDescriptor(u,"checked").set;if(m!==l&&r){const j=new Event("click",{bubbles:c});o.indeterminate=T(l),r.call(o,T(l)?!1:l),o.dispatchEvent(j)}},[m,l,c]),d.createElement("input",ee({type:"checkbox","aria-hidden":!0,defaultChecked:T(l)?!1:l},x,{tabIndex:-1,ref:n,style:{...t.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function T(t){return t==="indeterminate"}function be(t){return T(t)?"indeterminate":t?"checked":"unchecked"}const ve=At,Et=Ft,ge=d.forwardRef(({className:t,...a},l)=>e.jsx(ve,{ref:l,className:oe("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...a,children:e.jsx(Et,{className:oe("flex items-center justify-center text-current"),children:e.jsx(Ve,{className:"h-4 w-4"})})}));ge.displayName=ve.displayName;const wt=()=>{const{returnInvoice:t,setReturnInvoice:a}=A();return e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[e.jsx(ge,{id:"cash-refund",checked:!!t.is_cash_refund,onCheckedChange:l=>{a(c=>({...c,is_cash_refund:Number(l)}))}}),e.jsx(P,{htmlFor:"cash-refund",children:"Cash refund"})]})},Mt=()=>{const[t,a]=d.useState("IVC01-"),{searchInvoice:l,returnableItems:c,returnInvoice:x}=A(),n=m=>{m.preventDefault(),l(t).then(p=>{F.success(p)}).catch(p=>{F.error(p)})};return e.jsx(e.Fragment,{children:e.jsxs("form",{onSubmit:n,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row justify-between w-full gap-4",children:[e.jsx(R,{value:t,maxLength:15,onChange:m=>a(m.target.value)}),e.jsxs(C,{type:"submit",variant:x.invoice_id?"outline":"default",className:"flex items-center gap-2",children:[e.jsx(Ge,{size:16,strokeWidth:2.5}),"Search Invoice Code"]})]}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-row items-center justify-between w-full gap-5 pb-4",children:[e.jsx(Ct,{}),e.jsxs("div",{className:"flex flex-row items-center gap-6",children:[e.jsx(wt,{}),e.jsx(St,{})]})]}),e.jsx(It,{})]})]})})},Ot=()=>{const{returnInvoice:t,updateQuantity:a,isSubmitting:l,removeReturnItem:c}=A();return[{id:"itemNumber",accessorKey:"id",header:()=>e.jsx("div",{className:"flex justify-center",children:"Item #"}),cell:({row:n})=>e.jsx("div",{className:"flex justify-center",children:n.index+1}),size:100},{accessorKey:"quantityPurchased",header:()=>e.jsx("div",{className:"flex justify-center",children:"QTY Purchased"}),size:50,cell:({row:n})=>e.jsx("div",{className:"flex ",children:n.original.quantity})},{accessorKey:"quantityReturn",header:()=>e.jsx("div",{className:"flex justify-center",children:"QTY To Return"}),size:100,cell:({row:n})=>{var m,p,o;return e.jsxs("div",{className:"flex w-full flex-row justify-center ",children:[e.jsx(C,{className:"rounded-sm bg-red-300 hover:bg-red-500 disabled:opacity-100",onClick:()=>{var u;a(n.original.id,(((u=t.return_items.find(f=>f.invoice_item_id===n.original.id))==null?void 0:u.quantity)??1)-1)},disabled:(((m=t.return_items.find(u=>u.invoice_item_id===n.original.id))==null?void 0:m.quantity)??1)===1||l,children:e.jsx("span",{children:"-"})}),e.jsx(R,{type:"number",min:1,className:"max-w-[100px]",readOnly:!0,value:((p=t.return_items.find(u=>u.invoice_item_id===n.original.id))==null?void 0:p.quantity)??1}),e.jsx(C,{className:"rounded-sm bg-slate-500 hover:bg-slate-700 disabled:bg-slate-200",onClick:()=>{var u;a(n.original.id,(((u=t.return_items.find(f=>f.invoice_item_id===n.original.id))==null?void 0:u.quantity)??1)+1)},disabled:n.original.quantity===(((o=t.return_items.find(u=>u.invoice_item_id===n.original.id))==null?void 0:o.quantity)??1)||l,children:e.jsx("span",{children:"+"})})]})}},{accessorKey:"product.name",size:100,header:()=>e.jsx("div",{className:"justify-center",children:"Product"}),cell:({row:n})=>e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex flex-row items-center gap-2",children:[n.original.product.brand&&e.jsxs("span",{className:"text-sm font-light",children:["(",n.original.product.brand,")"]}),e.jsx("span",{className:"text-sm font-bold",children:n.original.product.name}),"•",e.jsx("span",{className:"text-sm font-medium capitalize",children:n.original.product.size}),"•",e.jsx("span",{className:"text-sm font-bold uppercase",children:n.original.product.color})]})})},{accessorKey:"product_price",size:100,header:()=>e.jsx("div",{className:"justify-center",children:"Price"}),cell:({row:n})=>e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{className:"flex flex-row gap-2",children:e.jsx("span",{className:"text-sm font-bold",children:U(n.original.product_price)})})})},{id:"actions",size:100,cell:({row:n})=>e.jsx("div",{className:"flex flex-row justify-center text-xs font-normal uppercase",children:e.jsx(C,{className:"bg-red-500 hover:bg-red-700",onClick:()=>{c(n.original.id)},children:e.jsx(nt,{color:"#FFF"})})})}]},qt=({})=>{const{selectedItems:t}=A(),a=Ot();return e.jsx(e.Fragment,{children:t.length>0&&e.jsx("div",{children:e.jsx(he,{columns:a,data:t,filterWhat:"id",hideFilter:!0,hidePagination:t.length<10,dataType:"returnItems"})})})},Lt=()=>{const{returnInvoice:t}=A();return e.jsxs("div",{className:"flex w-full flex-row justify-end gap-8 border-t px-6 pt-2 text-base",children:[t.return_items&&e.jsxs("h3",{className:"space-x-2",children:[e.jsx("span",{className:"font-medium",children:"Total items:"}),e.jsx("span",{className:"font-bold",children:t.return_items.length})]}),!!t.refundable_amount&&e.jsxs("h3",{className:"space-x-2",children:[e.jsx("span",{className:"font-medium",children:"Refundable amount:"}),e.jsx("span",{className:"font-bold",children:Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(t.refundable_amount)})]})]})},Yt=()=>{const t=G();return e.jsx(e.Fragment,{children:e.jsx(_t,{children:e.jsxs("div",{className:"flex h-screen w-screen flex-row",children:[e.jsx(te,{}),e.jsxs("div",{className:"flex max-h-full w-full flex-col gap-4 overflow-y-auto p-6 pt-12 text-slate-700",children:[e.jsxs("div",{className:"mx-auto w-full max-w-[1024px] space-y-6",children:[e.jsxs("div",{className:"flex w-full flex-row items-start justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Search Invoice Code to return items"}),e.jsxs(C,{className:"flex flex-row items-center gap-2 bg-gray-200 text-sm font-bold text-gray-700 hover:bg-gray-300 hover:text-gray-700",onClick:()=>{t(-1)},children:[e.jsx(Y,{size:20,strokeWidth:2.5}),"Go Back"]})]}),e.jsx("div",{children:e.jsx(Mt,{})})]}),e.jsx(qt,{}),e.jsx(Lt,{})]})]})})})};export{Qt as AddProductPOSPage,Yt as ReturnItemsPosPage,Ut as SelectWarehousePos};
